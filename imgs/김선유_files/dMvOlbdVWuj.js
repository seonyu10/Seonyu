if (self.CavalryLogger) { CavalryLogger.start_js(["AB0UK"]); }

__d("ImageUtils",["UserAgent_DEPRECATED"],(function a(b,c,d,e,f,g){__p&&__p();var h={hasLoaded:function i(j){__p&&__p();if(j.naturalWidth!==undefined)return j.complete&&j.width!==0;else if(j.height==20&&j.width==20&&j.complete)return false;else if(j.complete===undefined&&c("UserAgent_DEPRECATED").webkit()<500){var k=new Image();k.src=j.src;return k.complete}return j.complete}};f.exports=h}),null);
__d("PhotoEverstoreLogger",["Event","AsyncRequest","ImageUtils"],(function a(b,c,d,e,f,g){__p&&__p();var h={BATCH_WINDOW_MS:500,storedLog:[]};function i(){}Object.assign(i,{_log:function k(l){h.storedLog.push(l);if(h.storedLog.length==1)setTimeout(j,h.BATCH_WINDOW_MS)},logImmediately:function k(l){i._log(l)},registerForLogging:function k(l){var m=document.getElementById(l);if(m!=null)if(c("ImageUtils").hasLoaded(m))i._log(m.src);else c("Event").listen(m,"load",function(event){i._log(m.src)})}});function j(){var k=h.storedLog;h.storedLog=[];var l=JSON.stringify(k);new(c("AsyncRequest"))().setURI("/ajax/photos/logging/everstore_logging.php").setData({loggedUrls:l}).setMethod("POST").setOption("suppressErrorHandlerWarning",true).setOption("suppressErrorAlerts",true).send()}f.exports=i}),null);
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector"],(function a(b,c,d,e,f,g){__p&&__p();function h(i){"use strict";__p&&__p();this._hiResDimensions=i.hiResDimensions&&c("Vector").deserialize(i.hiResDimensions);this._normalDimensions=i.normalDimensions&&c("Vector").deserialize(i.normalDimensions);this._info=i.info;this._video=i.video;this._shouldLog=i.everstoreLogThis;this._hiResSrc=i.hiResSrc;this._normalSrc=i.normalSrc;this._thumbSrc=i.thumbSrc;this._isInverted=false;this._data=i}h.prototype.getURIString=function(){"use strict";return new(c("URI"))(this._info.permalink).getUnqualifiedURI().toString()};h.prototype.hasHiResDimensions=function(){"use strict";return!!this._hiResDimensions};h.prototype.getHiResDimensions=function(){"use strict";return this._hiResDimensions};h.prototype.getNormalDimensions=function(){"use strict";return this._normalDimensions};h.prototype.getHiResSrc=function(){"use strict";return this._hiResSrc};h.prototype.getNormalSrc=function(){"use strict";return this._normalSrc};h.prototype.getThumbSrc=function(){"use strict";return this._thumbSrc};h.prototype.getInfo=function(){"use strict";return this._info};h.prototype.getPermalink=function(){"use strict";return this._info.permalink};h.prototype.getHighestResSrc=function(){"use strict";return this._hiResSrc||this._normalSrc};h.prototype.preload=function(i){"use strict";__p&&__p();var j;if(this.getHighestResSrc())if(i&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();j=this._resource.src;if(this._shouldLog)c("PhotoEverstoreLogger").logImmediately(this._resource.src)}else if(!i&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;j=this._small.src;if(this._shouldLog)c("PhotoEverstoreLogger").logImmediately(this._small.src)}return j};h.prototype.setNormalDimensions=function(i,j){"use strict";this._normalDimensions=new(c("Vector"))(i,j)};h.prototype.setHiResDimensions=function(i,j){"use strict";this._hiResDimensions=new(c("Vector"))(i,j)};h.prototype.invertDimensions=function(){"use strict";if(this.hasHiResDimensions())this._hiResDimensions=new(c("Vector"))(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new(c("Vector"))(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted};h.prototype.copy=function(){"use strict";return new h(this._data)};f.exports=h}),null);
__d("PhotosConst",[],(function a(b,c,d,e,f,g){var h={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_COMPOSER:16,VIEWER_CAROUSEL:19,VIEWER_SPHERICAL:20,VIEWER_PERMALINK_STRING:"permalink",VIEWER_SNOWLIFT_STRING:"snowlift",VIEWER_VAULTBOX_STRING:"vaultbox",VIEWER_CAROUSEL_STRING:"carousel",BULK_EDITOR:3,BULK_EDITOR_REACT:15,EDITOR_MODAL:17,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:"n",PIC_NORMAL_FBX_SIZE:180,ALBUM_NAME_MAXLEN:65};f.exports=h}),null);
__d("PhotoStreamCache",["DOM","HTML","PhotoEverstoreLogger","PhotosConst","PhotoViewerImage","Rect","UIPagelet","URI","Vector","ge"],(function a(b,c,d,e,f,g){__p&&__p();function h(){"use strict"}h.prototype.init=function(i,j,k,l,m){"use strict";__p&&__p();this.version=i;this.pageletName=j;this.pageletRootID=k;this.tagSuggestionMode=m;this.bufferSize=h.BUFFER_SIZE;this.fullBucketSize=h.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=l;this.viewAsUser=null;this.reset()};h.prototype.setViewAs=function(i){"use strict";this.viewAsUser=i};h.prototype.isInViewAsMode=function(){"use strict";return!!this.viewAsUser};h.prototype.getViewAsUserId=function(){"use strict";return this.viewAsUser};h.prototype.getUsesOpaqueCursor=function(){"use strict";return this.usesOpaqueCursor};h.prototype.isNonCircularPhotoSet=function(){"use strict";return this.usesNonCircularPhotoSet};h.prototype.setReachedLeftEnd=function(){"use strict";this.reachedLeftEnd=true};h.prototype.setReachedRightEnd=function(){"use strict";this.reachedRightEnd=true};h.prototype.hasReachedLeftEnd=function(){"use strict";return this.reachedLeftEnd};h.prototype.hasReachedRightEnd=function(){"use strict";return this.reachedRightEnd};h.prototype.nonCircularPhotoSetCanPage=function(i){"use strict";if(!this.isNonCircularPhotoSet())return true;if(i<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(i>0)return this.getLength()-1!=this.getCursorPos()||!this.hasReachedRightEnd();return true};h.prototype.setUseAjaxPipe=function(i){"use strict";this.useAjaxPipe=i};h.prototype.reset=function(){"use strict";__p&&__p();this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null};h.prototype.waitForInitData=function(){"use strict";this.fbidList.push(h.INIT_PLACEHOLDER)};h.prototype.destroy=function(){"use strict";this.reset();this.isActive=false};h.prototype.isLoaded=function(){"use strict";return this.loaded};h.prototype.canPage=function(){"use strict";if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1};h.prototype.errorInCurrent=function(){"use strict";if(this.initError)return true;else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor())};h.prototype.getLength=function(){"use strict";return this.fbidList.length};h.prototype.getPhotoSet=function(){"use strict";return this.photoSetQuery.set};h.prototype.getPhotoSetQuery=function(){"use strict";return this.photoSetQuery};h.prototype.getCurrentImageData=function(){"use strict";return this.getImageData(this.getCursor())};h.prototype.getNextImageData=function(){"use strict";if(!this.fbidList||!this.fbidList.length)return null;var i=(this.position+1)%this.fbidList.length;return this.getImageData(this.getCursorAt(i))};h.prototype.getPreviousImageData=function(){"use strict";if(!this.fbidList||!this.fbidList.length)return null;var i=this.fbidList.length,j=(this.position+i-1)%i;return this.getImageData(this.getCursorAt(j))};h.prototype.addViewAsToURI=function(i){"use strict";var j=new(c("URI"))(i);if(this.isInViewAsMode())j.addQueryData({viewas:this.getViewAsUserId()});return j};h.prototype.getOpaqueCursor=function(i){"use strict";if(this.getImageData(i)){if(this.version===c("PhotosConst").VIEWER_VAULTBOX)return this.getImageData(i).getInfo().opaquecursor;return this.getImageData(i).info.opaquecursor}if(i==this.firstCursor)return this.firstOpaqueCursor;return null};h.prototype.getImageData=function(i){"use strict";var j=this.getCacheContent(i,h.IMAGE_DATA);if(j)j.info.permalink=this.addViewAsToURI(j.info.permalink);return j};h.prototype.getCurrentHtml=function(){"use strict";return this.getCacheContent(this.getCursor(),h.HTML)};h.prototype.getCurrentExtraData=function(){"use strict";return this.getCacheContent(this.getCursor(),h.EXTRA)};h.prototype.getCacheContent=function(i,j){"use strict";if(!i||i===h.ERROR_ID||i===h.INIT_PLACEHOLDER)return null;return this.cache[j][i]};h.prototype.getCursorPos=function(){"use strict";return this.position};h.prototype.getCursor=function(){"use strict";if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null};h.prototype.getCursorAt=function(i){"use strict";return this.fbidList[i]};h.prototype.getCursorForURI=function(i){"use strict";return this.permalinkMap[i]};h.prototype.calculatePositionForMovement=function(i){"use strict";var j=this.position+i;if(this.allLoaded){var k=this.getLength();j=(k+j%k)%k}return j};h.prototype.isValidMovement=function(i){"use strict";if(!this.isLoaded()||!this.canPage())return false;var j=this.calculatePositionForMovement(i);return this.getCursor()>0||j>=0&&j<this.getLength()};h.prototype.moveCursor=function(i){"use strict";if(!this.isValidMovement(i))return;this.position=this.calculatePositionForMovement(i);if(i!==0)this.loadMoreIfNeccessary(i>0)};h.prototype.checkErrorAt=function(i){"use strict";if(!this.isLoaded())return false;if(i===h.ERROR_ID)return true;return false};h.prototype.getRelativeMovement=function(i){"use strict";for(var j=0;j<this.getLength();j++)if(this.fbidList[j]==i)return j-this.position;return null};h.prototype.preloadImages=function(i){"use strict";__p&&__p();var j,k,l=this.getLength(),m=this.cache.image,n=h.BUFFER_SIZE;if(l>n*2){j=(this.position+l-n%l)%l;k=(this.position+n)%l}else{j=0;k=l-1}while(j!=k){var o,p=this.fbidList[j],q=i&&i(m[p]);if(this.version===c("PhotosConst").VIEWER_VAULTBOX)o=m[p]&&m[p].preload(q);else if(m[p]&&m[p].url)if(q&&!m[p].resource){m[p].resource=new Image();m[p].resource.src=m[p].url;o=m[p].url;if(m[p].everstoreLogThis===true)c("PhotoEverstoreLogger").logImmediately(m[p].resource.src)}else if(!q&&!m[p].small){m[p].small=new Image();m[p].small.src=m[p].smallurl||m[p].url;o=m[p].small.src;if(m[p].everstoreLogThis===true)c("PhotoEverstoreLogger").logImmediately(m[p].small.src)}if(this.logger&&o)this.logger.log(o);j=(j+1)%l}};h.prototype.loadMoreIfNeccessary=function(i){"use strict";__p&&__p();if(this.allLoaded||i&&this.rightLock||!i&&this.leftLock)return;var j=i?1:-1,k=this.position+this.bufferSize*j;if(k<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false)}else if(k>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true)}};h.prototype.getEndCursor=function(i){"use strict";return i?this.fbidList[this.getLength()-1]:this.fbidList[0]};h.prototype.calculateRelativeIndex=function(i,j,k){"use strict";if(!this.totalCount)return null;var l=this.fbidList.indexOf(j),m=this.fbidList.indexOf(k);if(l===-1||m===-1)return null;var n=m-l;return(i+n+this.totalCount)%this.totalCount};h.prototype.calculateDistance=function(i,j){"use strict";var k=this.fbidList.indexOf(i),l=this.fbidList.indexOf(j);if(k===-1||l===-1)return null;return(l-k+this.getLength())%this.getLength()};h.prototype.fetch=function(i,j){"use strict";__p&&__p();var k=this.getEndCursor(j),l=babelHelpers["extends"]({cursor:k,version:this.version,end:this.getEndCursor(!j),fetchSize:j?i:-1*i,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(k),tagSuggestionMode:this.tagSuggestionMode,is_from_groups:this.isFromGroups},this.photoSetQuery);if(this.isInViewAsMode())l.viewas=this.getViewAsUserId();if(this.totalCount&&this.firstCursorIndex!==null){l.total=this.totalCount;l.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,k)}var m=c("ge")(this.pageletRootID);if(!m){m=c("DOM").create("div",{id:this.pageletRootID});c("DOM").appendContent(document.body,m)}c("UIPagelet").loadFromEndpoint(this.pageletName,m,l,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true)};h.prototype.storeToCache=function(i){"use strict";__p&&__p();var j={};if(!this.isActive)return j;if("error"in i){this.processErrorResult(i.error);j.error=true;return j}if("init"in i){this.processInitResult(i.init);j.init={logids:i.init.logids,fbid:i.init.fbid,loggedin:i.init.loggedin,fromad:i.init.fromad,withinbusiness:i.init.withinbusiness,eid:i.init.eid}}if("image"in i){this.processImageResult(i.image);j.image=true}if("data"in i){this.processDataResult(i.data);j.data=true}return j};h.prototype.processInitResult=function(i){"use strict";__p&&__p();if(this.loaded)return;this.usesOpaqueCursor=i.usesopaquecursor;this.usesNonCircularPhotoSet=i.isnoncircularphotoset;this.setIsFromGroups(i.is_from_groups);this.loaded=true;this.photoSetQuery=i.query;if(i.bufferSize)this.bufferSize=i.bufferSize;if(i.fullBucketSize)this.fullBucketSize=i.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(i.fbid);this.rightLock=true}else{var j=this.fbidList.indexOf(h.INIT_PLACEHOLDER);if(j!=-1)this.fbidList[j]=i.fbid}this.firstCursor=i.fbid;this.firstOpaqueCursor=i.opaquecursor;if("initIndex"in i&&"totalCount"in i){this.firstCursorIndex=i.initIndex;this.totalCount=i.totalCount}if(this.version==c("PhotosConst").VIEWER_PERMALINK){var k=i.initialBucketSize?i.initialBucketSize:h.INIT_BUCKET_SIZE;this.fetch(k,true)}};h.prototype.processImageResult=function(i){"use strict";__p&&__p();for(var j in i){if(j===this.firstCursor&&i[j].everstoreLogThis)c("PhotoEverstoreLogger").logImmediately(i[j].url);if(this.version===c("PhotosConst").VIEWER_VAULTBOX){var k=i[j];this.cache.image[j]=new(c("PhotoViewerImage"))(k);this.permalinkMap[this.cache.image[j].getURIString()]=j}else{this.cache.image[j]=i[j];if(i[j].dimensions)this.cache.image[j].dimensions=c("Vector").deserialize(i[j].dimensions);if(i[j].originalDimensions)this.cache.image[j].originalDimensions=c("Vector").deserialize(i[j].originalDimensions);if(i[j].smalldims)this.cache.image[j].smalldims=c("Vector").deserialize(i[j].smalldims);this.permalinkMap[new(c("URI"))(i[j].info.permalink).getUnqualifiedURI().toString()]=j}}};h.prototype.attachToFbidsList=function(i,j,k){"use strict";__p&&__p();if(this.allLoaded)return;if(j===-1){for(var l=i.length-1;l>=0;l--){this.fbidList.unshift(i[l]);this.position++}this.leftLock=false}else{for(var m=0;m<i.length;m++)this.fbidList.push(i[m]);this.rightLock=false}if(k)this.setAllLoaded()};h.prototype.setAllLoaded=function(){"use strict";this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0)};h.prototype.processDataResult=function(i){"use strict";__p&&__p();for(var j in i){if(!this.cache.html[j])this.cache.html[j]={};for(var k in i[j].html){var l=i[j].html[k];if(typeof l==="string")l=c("HTML")(l).getRootNode();if(l.childNodes)this.cache.html[j][k]=Array.from(l.childNodes);else this.cache.html[j][k]=[]}if(!("extra"in i[j])){this.cache.extra[j]=null;continue}this.cache.extra[j]={tagRects:{}};if(!Array.isArray(i[j].extra.tagRects))for(var m in i[j].extra.tagRects)if(i[j].extra.tagRects[m])this.cache.extra[j].tagRects[m]=c("Rect").deserialize(i[j].extra.tagRects[m]);Object.keys(i[j].extra).forEach(function(n){if(n=="tagRects")return;this.cache.extra[j][n]=i[j].extra[n]}.bind(this))}};h.prototype.processErrorResult=function(i){"use strict";if(!this.isLoaded()){this.initError=true;return}var j=i.side,k=[h.ERROR_ID];this.attachToFbidsList(k,j)};h.prototype.setTotalCount=function(i){"use strict";this.totalCount=i};h.prototype.setFirstCursorIndex=function(i){"use strict";this.firstCursorIndex=i};h.prototype.setIsFromGroups=function(i){"use strict";this.isFromGroups=i};Object.assign(h,{ERROR:"error",HTML:"html",IMAGE_DATA:"image",EXTRA:"extra",BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});f.exports=h}),null);
__d("XPhotosetSearchPivotController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/search-pivot/photoset/",{fbid:{type:"Int",required:true},tags:{type:"IntToIntMap"}})}),null);
__d("PhotosetSearchPivotData",["Promise","AsyncRequest","PhotoStreamCache","XPhotosetSearchPivotController"],(function a(b,c,d,e,f,g){__p&&__p();var h=/^(perm:)?tag:(\d+)/,i={},j={fetch:function k(l,m){__p&&__p();var n;if(!(l in i)){var o;(function(){__p&&__p();var p=c("XPhotosetSearchPivotController").getURIBuilder().setInt("fbid",l);if(m){o={};m.fbidList.forEach(function(q){var r=m.getCacheContent(q,c("PhotoStreamCache").EXTRA);if(r)Object.keys(r.tagRects).forEach(function(s){if(h.test(s)){var t=RegExp.$2;if(t in o)o[t]++;else o[t]=1}})});p.setIntToIntMap("tags",o)}i[l]=new(c("Promise"))(function(q,r){new(c("AsyncRequest"))().setURI(p.getURI()).setHandler(function(s){q(s.getPayload())}).setErrorHandler(r).setAllowCrossPageTransition(true).send()})})()}return i[l]["catch"](function(p){delete i[l];throw p})}};f.exports=j}),null);
__d("tickerPhoteSnowLiftOpenStatus",["ArbiterMixin"],(function a(b,c,d,e,f,g){var h="CheckIsOpen",i={registerOpenChecker:function j(k){return i.subscribe(h,function(l,m){if(k())m.is_Open=true})},checkIsOpen:function j(){var k={is_Open:false};i.inform(h,k);return k.is_Open}};Object.assign(i,c("ArbiterMixin"));f.exports=i}),null);
__d("SphericalPhotoViewerTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(){this.clear()}h.prototype.log=function(){c("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$SphericalPhotoViewerTypedLogger1,c("Banzai").BASIC)};h.prototype.logVital=function(){c("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$SphericalPhotoViewerTypedLogger1,c("Banzai").VITAL)};h.prototype.clear=function(){this.$SphericalPhotoViewerTypedLogger1={};return this};h.prototype.updateData=function(j){this.$SphericalPhotoViewerTypedLogger1=babelHelpers["extends"]({},this.$SphericalPhotoViewerTypedLogger1,j);return this};h.prototype.setAvgFrameRenderTime=function(j){this.$SphericalPhotoViewerTypedLogger1.avg_frame_render_time=j;return this};h.prototype.setAvgTextureToScreenRatio2=function(j){this.$SphericalPhotoViewerTypedLogger1.avg_texture_to_screen_ratio2=j;return this};h.prototype.setClientUserID=function(j){this.$SphericalPhotoViewerTypedLogger1.client_userid=j;return this};h.prototype.setComposerSessionID=function(j){this.$SphericalPhotoViewerTypedLogger1.composer_session_id=j;return this};h.prototype.setCountry=function(j){this.$SphericalPhotoViewerTypedLogger1.country=j;return this};h.prototype.setDevicePixelRatio=function(j){this.$SphericalPhotoViewerTypedLogger1.device_pixel_ratio=j;return this};h.prototype.setDt=function(j){this.$SphericalPhotoViewerTypedLogger1.dt=j;return this};h.prototype.setErrorCode=function(j){this.$SphericalPhotoViewerTypedLogger1.error_code=j;return this};h.prototype.setErrorMessage=function(j){this.$SphericalPhotoViewerTypedLogger1.error_message=j;return this};h.prototype.setErrorStackTrace=function(j){this.$SphericalPhotoViewerTypedLogger1.error_stack_trace=j;return this};h.prototype.setErrorType=function(j){this.$SphericalPhotoViewerTypedLogger1.error_type=j;return this};h.prototype.setEventType=function(j){this.$SphericalPhotoViewerTypedLogger1.event_type=j;return this};h.prototype.setFallbackUI=function(j){this.$SphericalPhotoViewerTypedLogger1.fallback_ui=j;return this};h.prototype.setIsGyroEnabled=function(j){this.$SphericalPhotoViewerTypedLogger1.is_gyro_enabled=j;return this};h.prototype.setMaxGpuMemoryUsed=function(j){this.$SphericalPhotoViewerTypedLogger1.max_gpu_memory_used=j;return this};h.prototype.setMaxTileLevel=function(j){this.$SphericalPhotoViewerTypedLogger1.max_tile_level=j;return this};h.prototype.setName=function(j){this.$SphericalPhotoViewerTypedLogger1.name=j;return this};h.prototype.setNumberOfSphericalPhoto=function(j){this.$SphericalPhotoViewerTypedLogger1.number_of_spherical_photo=j;return this};h.prototype.setPhotoID=function(j){this.$SphericalPhotoViewerTypedLogger1.photo_id=j;return this};h.prototype.setPitch=function(j){this.$SphericalPhotoViewerTypedLogger1.pitch=j;return this};h.prototype.setRenderMethod=function(j){this.$SphericalPhotoViewerTypedLogger1.render_method=j;return this};h.prototype.setSphericalPhotoSessionID=function(j){this.$SphericalPhotoViewerTypedLogger1.spherical_photo_session_id=j;return this};h.prototype.setSurface=function(j){this.$SphericalPhotoViewerTypedLogger1.surface=j;return this};h.prototype.setTotalDataLoaded=function(j){this.$SphericalPhotoViewerTypedLogger1.total_data_loaded=j;return this};h.prototype.setVfov=function(j){this.$SphericalPhotoViewerTypedLogger1.vfov=j;return this};h.prototype.setViewportHeight=function(j){this.$SphericalPhotoViewerTypedLogger1.viewport_height=j;return this};h.prototype.setViewportWidth=function(j){this.$SphericalPhotoViewerTypedLogger1.viewport_width=j;return this};h.prototype.setYaw=function(j){this.$SphericalPhotoViewerTypedLogger1.yaw=j;return this};var i={avg_frame_render_time:true,avg_texture_to_screen_ratio2:true,client_userid:true,composer_session_id:true,country:true,device_pixel_ratio:true,dt:true,error_code:true,error_message:true,error_stack_trace:true,error_type:true,event_type:true,fallback_ui:true,is_gyro_enabled:true,max_gpu_memory_used:true,max_tile_level:true,name:true,number_of_spherical_photo:true,photo_id:true,pitch:true,render_method:true,spherical_photo_session_id:true,surface:true,total_data_loaded:true,vfov:true,viewport_height:true,viewport_width:true,yaw:true};f.exports=h}),null);
__d("SpotlightViewerLoggingEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"})}),null);
__d("PhotoLogger",["Event","Banzai","BanzaiScuba","SpotlightViewerLoggingEvents","SubscriptionsHandler"],(function a(b,c,d,e,f,g){__p&&__p();function h(i){"use strict";this.$PhotoLogger1=i;this.$PhotoLogger2={}}h.prototype.log=function(i,j,k,l){"use strict";c("Banzai").post("profile_photos_view",{photo_fbid:j,source:k,profile_id:l});if(!this.$PhotoLogger2[i]){this.$PhotoLogger3(i);this.$PhotoLogger2[i]=true}};h.prototype.$PhotoLogger3=function(i){"use strict";__p&&__p();this.$PhotoLogger4(c("SpotlightViewerLoggingEvents").LOADING,{uri:i});var j=new(c("SubscriptionsHandler"))(),k=new Image();j.addSubscriptions(c("Event").listen(k,"load",function(){this.$PhotoLogger4(c("SpotlightViewerLoggingEvents").LOADED,{uri:i});j.release()}.bind(this)),c("Event").listen(k,"error",function(){this.$PhotoLogger4(c("SpotlightViewerLoggingEvents").ERROR,{uri:i});j.release()}.bind(this)),c("Event").listen(k,"abort",function(){this.$PhotoLogger4(c("SpotlightViewerLoggingEvents").ABORT,{uri:i});j.release()}.bind(this)));k.src=i};h.prototype.logEvent=function(i){"use strict";this.$PhotoLogger4(i)};h.prototype.$PhotoLogger4=function(i,j){"use strict";var k=new(c("BanzaiScuba"))("photos_client_loading",null,{addBrowserFields:true});k.addNormal("event",i);k.addNormal("viewer",this.$PhotoLogger1);for(var l in j)k.addNormal(l,j[l]);k.post()};f.exports=h}),null);
__d("PhotoSessionLog",["AsyncRequest","Run","URI","Vector","WWWBase"],(function a(b,c,d,e,f,g){__p&&__p();function h(){}Object.assign(h,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,LOADING:8,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:"",cycle:false,endOfRelevant:false,relevantCount:0,closingTypeToString:function i(j){return{0:"UNKNOWN",1:"ESC",2:"X",3:"OUTSIDE",4:"UNLOAD",5:"NAVIGATE"}[j]||"UNKNOWN"},initLogging:function i(j){__p&&__p();this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.eid="";this.version=j;this.buttonLikes=0;this.pagingAction="";this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;this.topLevelPostId=0;if(j===h.SNOWLIFT){var k=c("Vector").getViewportDimensions();this.width=k.x;this.height=k.y}},_isSnowlift:function i(){return this.version===h.SNOWLIFT},setLogFbids:function i(j){this.logIds=j},setTopLevelPostId:function i(j){this.topLevelPostId=j},setEid:function i(j){this.eid=j},setPhotoSet:function i(j){this.set=j},addButtonLike:function i(){this.buttonLikes++},setPagingAction:function i(j){this.pagingAction=j},setCycle:function i(j){this.cycle=j},setEndOfRelevant:function i(j){this.endOfRelevant=j},setRelevantCount:function i(j){this.relevantCount=j},setEndMetrics:function i(j){this.endMetrics=j},setSource:function i(j){this.source=j},addPhotoView:function i(j,k,l){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(j)this.fbidList.push([j.fbid,j.owner,Date.now()]);if(k)this.hiResLoads++;if(l)this.fullScreenViews[j.fbid]=true},logEnterFullScreen:function i(j){this.fullScreenViews[j]=true},addDetailData:function i(j,k){if(!this.details[j])this.details[j]={t:k.num_tags,l:k.has_location,c:k.has_caption,cm:k.comment_count,lk:k.like_count,w:k.width,h:k.height,ad:"{}",p:this.pagingAction}},updateAdData:function i(j,k){if(this.details[j])this.details[j].ad=JSON.stringify(k)},logPhotoViews:function i(j){__p&&__p();if(!this.views)return;if(j!=this.AGGREGATE)this.last=true;this.logData(j?j:this.UNKNOWN);this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={}}},logInitialLoad:function i(){this.logData(h.LOADING)},logData:function i(j){__p&&__p();var k=[],l={},m=0;if(j===this.LOADING){m=this.topLevelPostId;if(!this.topLevelPostId){k=this.fbidList;l=this.details}}else{k=this.fbidList;l=this.details}var n={set:this.set,time:new Date()-this.time,fbids:k,details:l,eid:this.eid,first:this.first,last:this.last,close:j,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,top_level_post_id:m};if(this.version===h.SNOWLIFT){var o=c("Vector").getViewportDimensions();n.width=o.x||this.width;n.height=o.y||this.height;if(this.hiResLoads>0)n.hires_loads=this.hiResLoads;if(this.last){var p=Object.keys(this.fullScreenViews).length;if(p>0)n.fullscreen=p}}var q=new(c("URI"))(c("WWWBase").uri).setPath("/ajax/photos/logging/session_logging.php");new(c("AsyncRequest"))().setAllowCrossPageTransition(true).setURI(q).setOption("asynchronous_DEPRECATED",j!=h.UNLOAD).setOption("suppressErrorHandlerWarning",true).setData(n).send()}});c("Run").onUnload(function(){h.logPhotoViews(h.UNLOAD)});c("Run").onLeave(function(){h.logPhotoViews(h.LEAVE)});f.exports=h}),null);
__d("PhotosUtils",["Vector"],(function a(b,c,d,e,f,g){__p&&__p();function h(){}Object.assign(h,{getNearestBox:function i(j,k){__p&&__p();var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n}}}return m},absoluteToNormalizedPosition:function i(j,k){var l=c("Vector").getElementPosition(j),m=c("Vector").getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain="pure";return n},normalizedToAbsolutePosition:function i(j,k){var l=c("Vector").getElementPosition(j),m=c("Vector").getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain="document";return n},isFacebox:function i(j){return j.match(/^face:/)},isTag:function i(j){return j.match(/^tag:/)}});f.exports=h}),null);
__d("PhotoPermalinkURI",[],(function a(b,c,d,e,f,g){__p&&__p();var h={isValid:function i(j){return h.parse(j)!==null},parse:function i(j){__p&&__p();if(this.isValidLegacy(j)){var k=j.getQueryData();if(k.fbid)return{photo_id:k.fbid,set_token:k.set};if(k.id&&k.pid)return{photo_id:k.id+":"+k.pid,set_token:k.set};return null}var l=j.getPath();if(l[l.length-1]==="/")l=l.substring(0,l.length-1);var m=l.split("/");if(m.length>=3&&m[2]==="photos")if(m.length===4&&/^\d+$/.exec(m[3])!==null)return{photo_id:m[3],set_token:null};else if(m.length===5&&/^\d+$/.exec(m[4])!==null)return{photo_id:m[4],set_token:m[3]};return null},isValidLegacy:function i(j){var k=j.getPath();if(k[k.length-1]==="/")k=k.substring(0,k.length-1);if(k==="/photo.php"||k==="/force_photo/photo.php"||k==="/photo"||k==="/force_photo/photo/index.php"||k==="/photo/index.php"||k==="/force_photo/photo"||k==="/video.php"||k==="/video/video.php")return true;return false}};f.exports=h}),null);
__d("PhotoTagSearchPivotLogger",["Banzai"],(function a(b,c,d,e,f,g){__p&&__p();var h={};c("Banzai").subscribe(c("Banzai").SHUTDOWN,function(){Object.keys(h).forEach(function(l){var m=h[l];Object.keys(m).forEach(function(n){c("Banzai").post("photo_tag_search_pivot",{source:l,action:n,count:m[n]})})})});var i=/^(perm:)?tag:/,j,k={logImpression:function l(m,n){var o=m in h?h[m]:h[m]={};o[n]=n in o?o[n]+1:1},logImageImpression:function l(m,n,o){if(j!==n){if(o.some(function(p){return i.test(p)}))this.logImpression(m,"image_impression");j=n}},logPivotImpression:function l(m,n){if(i.test(n))this.logImpression(m,"pivot_impression")},logShowMorePhotos:function l(){this.logImpression("photoset","show_more_photos")},logHideMorePhotos:function l(){this.logImpression("photoset","hide_more_photos")},logSuggestMorePhotos:function l(){this.logImpression("photoset","suggest_more_photos")},logMorePhotosNavigation:function l(m){c("Banzai").post("photo_tag_search_pivot",{source:"photoset",action:"more_photos_search",query:m,count:1})}};f.exports=k}),null);
__d("PhotosetSearchPivot.react",["cx","fbt","LeftRight.react","PhotosetSearchPivotData","PhotoTagSearchPivotLogger","React","XUISpinner.react","XUIText.react","joinClasses"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j,k,l=c("React").PropTypes;j=babelHelpers.inherits(m,c("React").Component);k=j&&j.prototype;function m(){var o,p;"use strict";for(var q=arguments.length,r=Array(q),s=0;s<q;s++)r[s]=arguments[s];return p=(o=k.constructor).call.apply(o,[this].concat(r)),this.onClick=function(){c("PhotoTagSearchPivotLogger").logMorePhotosNavigation(this.props.normalized)}.bind(this),p}m.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_25r"},c("React").createElement("a",{onClick:this.onClick,href:this.props.uri,className:"_25t _3-8t"},c("React").createElement("div",{className:"_25u"},c("React").createElement("div",{className:"_25v _25w",style:{backgroundImage:"url("+this.props.images[0].uri+")"}}),c("React").createElement("div",{className:"_25x"},c("React").createElement("div",{className:"_25y"},c("React").createElement("div",{className:"_25z"}),c("React").createElement("div",{className:"_26r"},c("React").createElement("div",{className:"_273 _25w",style:{backgroundImage:"url("+this.props.images[1].uri+")"}}))),c("React").createElement("div",{className:"_274"},c("React").createElement("div",{className:"_25z"}),c("React").createElement("div",{className:"_26r"},c("React").createElement("div",{className:"_273 _25w",style:{backgroundImage:"url("+this.props.images[2].uri+")"}}))))),c("React").createElement(c("XUIText.react"),{display:"block",className:"_27f _2pi4",dangerouslySetInnerHTML:{__html:this.props.title.__html}})))};m.propTypes={normalized:l.string,title:l.object,uri:l.string,images:l.array};var n=c("React").createClass({displayName:"PhotosetSearchPivot",propTypes:{fbid:l.string,endofalbum:l.bool,withBackground:l.bool,linesAroundHeader:l.bool,onclose:l.func},fetchPivots:function o(p){c("PhotosetSearchPivotData").fetch(p).then(function(q){setTimeout(this.onFetchSuccess.bind(this,p,q.pivots),0)}.bind(this),function(q){setTimeout(this.onFetchError.bind(this,p),0)}.bind(this))},onFetchSuccess:function o(p,q){if(!this.isMounted()||this.props.fbid!==p)return;q=q||[];var r="show";if(q.length===0)r="hide";this.setState({pivots:q,action:r})},onFetchError:function o(p){if(!this.isMounted()||this.props.fbid!==p)return;this.setState({pivots:[],action:"hide"})},getInitialState:function o(){this.fetchPivots(this.props.fbid);return{pivots:[],action:"loading"}},componentWillReceiveProps:function o(p){if(p.fbid){this.setState({action:"loading"});this.fetchPivots(p.fbid)}else this.setState({action:"hide",pivots:[]})},onExitClicked:function o(){this.props.onclose()},render:function o(){__p&&__p();if(this.state.action==="loading")return c("React").createElement("div",{className:c("joinClasses")(this.props.className,"_27h _2ph_")},c("React").createElement(c("XUISpinner.react"),{size:"large"}));if(this.state.action==="hide")return c("React").createElement("span",null);var p=this.state.pivots.map(function(t){return c("React").createElement(m,{normalized:t.normalized,title:t.title,uri:t.uri,images:t.images})}),q=this.props.endofalbum?c("React").createElement("span",{className:"_2pij"},i._("\uc0ac\uc9c4\ucca9\uc758 \ub05d")):null,r="_27m _2pi3 _2pib"+(this.props.linesAroundHeader?" _3-te":""),s=c("React").createElement("span",null,q,c("React").createElement("span",{className:"_4ptz"},i._("\ud68c\uc6d0\ub2d8\uc774 \uc88b\uc544\ud560 \ub9cc\ud55c \ub2e4\ub978 \uc0ac\uc9c4")));if(this.props.onclose)s=c("React").createElement(c("LeftRight.react"),{className:r},s,c("React").createElement("a",{href:"#",onClick:this.onExitClicked,className:"_27n"}));else s=c("React").createElement("div",{className:r},s);return c("React").createElement("div",{className:c("joinClasses")(this.props.className,(this.state.action==="hide"?"_27j":"")+(this.state.action==="show"?" _27k":""))},c("React").createElement("div",{className:"_27l"+(this.props.withBackground?" _3-tf":"")},s,c("React").createElement("div",{className:"_27o _2pi8 clearfix"},p)))}});f.exports=n}),null);
__d("PhotosetPivotSlide.react",["ix","cx","fbt","xuiglyph","Image.react","Link.react","PhotosetSearchPivot.react","React","XUIText.react"],(function a(b,c,d,e,f,g,h,i,j,k){__p&&__p();var l,m,n=c("React").PropTypes;l=babelHelpers.inherits(o,c("React").Component);m=l&&l.prototype;function o(){__p&&__p();var p,q;"use strict";for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=m.constructor).call.apply(p,[this].concat(s)),this.$PhotosetPivotSlide1=function(){if(this.props.albumOwnerName)if(this.props.isAlbum)return j._("{user_name}\ub2d8\uc758 \uc0ac\uc9c4\ucca9 \ub05d",[j.param("user_name",c("React").createElement(c("XUIText.react"),{weight:"bold"},this.props.albumOwnerName))]);else return j._("{user_name}\ub2d8\uc758 \uc0ac\uc9c4 \ub05d",[j.param("user_name",c("React").createElement(c("XUIText.react"),{weight:"bold"},this.props.albumOwnerName))]);else if(this.props.isAlbum)return j._("\uc0ac\uc9c4\ucca9 \ub05d");else return j._("\uc0ac\uc9c4 \ub05d")}.bind(this),q}o.prototype.render=function(){"use strict";return c("React").createElement("div",{className:"_1_ap"+(this.props.visible?" _1_aq":"")},c("React").createElement("div",{className:"_1_ar"},c("React").createElement(c("XUIText.react"),{display:"block"},this.$PhotosetPivotSlide1()),c("React").createElement(c("Link.react"),{className:"_1_as",onClick:this.props.onReturn},c("React").createElement(c("Image.react"),{className:"_1_at",src:h("88724")}),j._("\ucc98\uc74c\uc73c\ub85c \ub3cc\uc544\uac00\uae30"))),c("React").createElement(c("PhotosetSearchPivot.react"),{className:"_1_au",fbid:this.props.visible?this.props.fbid:null,linesAroundHeader:true}))};o.propTypes={fbid:n.string,isAlbum:n.bool,albumOwnerName:n.string,visible:n.bool,onReturn:n.func};f.exports=o}),null);
__d("DisableContextMenuMixin",["Event","emptyFunction"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("emptyFunction"),i={getContextMenuContainer:h,_contextMenuEventHandler:null,disableContextMenu:function j(){if(this._contextMenuEventHandler)return;this._contextMenuEventHandler=c("Event").listen(this.getContextMenuContainer(),"contextmenu",function(k){k.preventDefault();k.stopPropagation()})},enableContextMenu:function j(){if(this._contextMenuEventHandler){this._contextMenuEventHandler.remove();this._contextMenuEventHandler=null}}};f.exports=i}),null);
__d("ObjectionableContentFilterMixin",["csx","cx","CSS","DOM","emptyFunction"],(function a(b,c,d,e,f,g,h,i){__p&&__p();var j=c("emptyFunction"),k={getObjectionableWarningContainer:j,getObjectionableWarningHiddenContent:j,_objectionableWarningMarkup:null,_objectionableWarningOverlay:null,_objectionableWarningHiddenContentWrapper:null,_objectionableWarningHiddenContent:null,showObjectionableWarning:function l(m){__p&&__p();var n="._f_2",o="._f_g";if(this._objectionableWarningMarkup)this.hideObjectionableWarning();this._objectionableWarningOverlay=c("DOM").scry(m,n).pop();this._objectionableWarningHiddenContentWrapper=c("DOM").scry(m,o).pop();this._objectionableWarningOverlay&&c("CSS").show(this._objectionableWarningOverlay);if(this._objectionableWarningHiddenContentWrapper){this.getObjectionableWarningContainer().replaceChild(m,this.getObjectionableWarningHiddenContent());this._objectionableWarningHiddenContentWrapper.appendChild(this.getObjectionableWarningHiddenContent());c("CSS").addClass(m,"_dbl")}this._objectionableWarningMarkup=m;this._objectionableWarningHiddenContent=this.getObjectionableWarningHiddenContent()},hideObjectionableWarning:function l(){if(!this.getObjectionableWarningContainer().contains(this._objectionableWarningMarkup))return;this.getObjectionableWarningContainer().replaceChild(this._objectionableWarningHiddenContent,this._objectionableWarningMarkup)}};f.exports=k}),null);
__d("PhotoSnowliftAds",["csx","Arbiter","CSS","DataAttributeUtils","DataStore","DOM","Event","PhotoSessionLog","UIPagelet","URI","Vector","cxodecode"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=void 0,j={REFRESH_RATE:3e4,UNITS_REGISTER_DELAY:1e3,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,displayedCallback:null,position:null,adsStatus:"null",adsEvents:{},resetEvents:function k(){this.adsStatus="reset";this.adsEvents={}},addEvent:function k(l,m){if(m)this.adsStatus=l;var n=Date.now();this.adsEvents[l+"_"+n]=n},init:function k(l,m,n,o){if(n.nonce)i=c("cxodecode")(n.nonce);this.reset();this.root=l;this.snowlift=m;this.minAds=n.min_ads;this.displayedCallback=o;this.addEvent("init",true)},reset:function k(){this.lastLoadTime=0;this.position=0;this.units=[];this.resetEvents();this.addEvent("reset",true)},resize:function k(l){this.availableDimensions=l;this.loadQuery=this.snowlift.getLoadQuery();this.processResize()},calculateUnitSizes:function k(l,m,n){__p&&__p();var o={};l.forEach(function(p){__p&&__p();var q=p.root.firstChild.offsetHeight;p.units.forEach(function(s){if(!c("CSS").hasClass(s,"hidden")&&!this.getIsHoldout(s)&&!this.getIsShadow(s)){var t=this.getHeight(s.firstChild,m);q-=t}}.bind(this));var r={height:q,visible:false};p.units.forEach(function(s){var t=this.getIsAds(s),u=this.getHeight(s.firstChild,m),v=this.getUnitId(s),w=this.getIsHoldout(s);if(w&&n)return;o[v]={height:u,visible:false,priority:0,is_ads:t,is_holdout:w,section_ref:r}}.bind(this))}.bind(this));return o},calculateVisibleUnits:function k(l,m,n){__p&&__p();var o=this.getUnitPriority(m);o.forEach(function(p){__p&&__p();if(Object.prototype.hasOwnProperty.call(m,p)){var q=m[p],r=q.height;if(!q.section_ref.visible)r+=q.section_ref.height;q.height_below=n-r;q.visible=q.height_below>=0&&r>0;if(q.visible){q.section_ref.visible=true;n-=r}}});return m},displayUnits:function k(l,m){__p&&__p();l.forEach(function(n){__p&&__p();var o=false,p=true;n.units.forEach(function(q){__p&&__p();var r=this.getUnitId(q),s=m[r];if(!s)return;var t=s.visible,u=s.height_below,v=s.is_ads;c("CSS").conditionClass(q,"hidden",!t);if(v&&t&&p){var w=c("DOM").find(q,"div.ego_unit");c("CSS").addClass(w,"ego_unit_no_top_border");p=false}o=o||t;this.calcUnitStats(this.units[v][r],t,u)}.bind(this));c("CSS").conditionClass(n.root,"hidden",!o)}.bind(this));c("Arbiter").inform("PhotoSnowliftAds/displayUnits")},getUnitsDisplayed:function k(l,m){var n=0;l.forEach(function(o){o.units.forEach(function(p){var q=this.getUnitId(p),r=m[q];if(!r||!r.visible)return;n++}.bind(this))}.bind(this));return n},getHeightsRequired:function k(l,m){__p&&__p();var n=0,o=[];l.forEach(function(p){__p&&__p();var q=false;p.units.forEach(function(r){var s=this.getUnitId(r),t=m[s];if(!t)return;n+=t.height;if(!q){n+=t.section_ref.height;q=true}o.push(n)}.bind(this))}.bind(this));return o},getUnitPriority:function k(l){__p&&__p();var m=[],n=0,o=0;for(var p in l){var q=l[p];m.push(p);var r=this.minAds+n+o;if(q.is_ads){if(o<this.minAds)r=o;o++}else n++;q.priority=r}m=m.sort(function(s,t){var u=l[s],v=l[t];return u.priority-v.priority});return m},updateUnitsStatus:function k(){__p&&__p();var l=this.availableDimensions.x,m=this.availableDimensions.y,n=this.calculateUnitSizes(this.sections,l);n=this.calculateVisibleUnits(this.sections,n,m);for(var o in n){if(!Object.prototype.hasOwnProperty.call(n,o))continue;var p=n[o];if(!p.is_holdout||!p.visible)continue;var q=this.units[1][o];this.calcUnitStats(q,p.visible,p.height_below)}n=this.calculateUnitSizes(this.sections,l,true);n=this.calculateVisibleUnits(this.sections,n,m);this.displayUnits(this.sections,n);if(this.displayedCallback){var r=this.getUnitsDisplayed(this.sections,n),s=this.getHeightsRequired(this.sections,n);this.displayedCallback(r,s)}},calcUnitStats:function k(l,m,n){__p&&__p();if(!l)return;var o=Date.now();if(l.visible)l.totalTime+=o-l.lastShowTime;if(l.trackingCode!==null&&l.totalTime>=this.UNITS_REGISTER_DELAY){var p=l.trackingCode;l.trackingCode=null;this.registerImpression(p,l.registerUrl)}l.visible=m;l.heightBelow=n;l.lastShowTime=o},prepareResize:function k(){var l=function l(m){var n=c("DOM").create("div",{className:"inner"}),o=c("DOM").create("div",{className:"wrapper"},n);c("DOM").replace(m,o);c("DOM").setContent(n,m);return o};this.sections=c("DOM").scry(this.root,"div.ego_section").map(function(m){return{root:l(m),units:c("DOM").scry(m,"div.ego_unit").map(l)}})},processResize:function k(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return}this.updateUnitsStatus();this.setLogData();var l=this.nextRegisterTime();if(l!==Infinity)setTimeout(this.processResize.bind(this),l)},setIsLogAdData:function k(l){this.isLogAdData=l;this.addEvent("setIsLogAdData",false);this.setLogData()},setLogData:function k(){var l=this.snowlift.getImageId();if(this.isLogAdData&&l){var m=c("Vector").getElementDimensions(this.snowlift.getImage()),n=c("Vector").getElementDimensions(this.snowlift.getRHCHeader()),o=c("Vector").getElementDimensions(this.snowlift.getRHCBody()),p=c("Vector").getElementDimensions(this.snowlift.getRHCFooter()),q={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:m.x,image_y:m.y,header_x:n.x,header_y:n.y,body_x:o.x,body_y:o.y,footer_x:p.x,footer_y:p.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents,refreshRate:this.refreshUnitsRate,position:this.position};c("PhotoSessionLog").updateAdData(l,q)}},getAdsBelowSpace:function k(){var l=[],m=this.units[1];for(var n in m)if(Object.prototype.hasOwnProperty.call(m,n)&&!this.getIsHoldout(this.getAdUnit(n)))l.push(m[n].heightBelow);return l},getIsAds:function k(l){var m=c("DOM").scry(l,i||"div._4u8");return m.length},getUnitId:function k(l){if(this.getIsAds(l))return this.getAdId(l);else return this.getEgoId(l)},getEgoId:function k(l){var m=c("DOM").find(l,"div.ego_unit");return m.getAttribute("data-ego-fbid")},getAdData:function k(l){var m=c("DOM").find(l,i||"div._4u8"),n=c("DataAttributeUtils").getDataAttribute(m,"data-ad");return n&&JSON.parse(n)||{}},getAdId:function k(l){return this.getAdData(l).adid},getIsHoldout:function k(l){return l&&this.getIsAds(l)&&this.getAdData(l).holdout},getIsShadow:function k(l){return l&&this.getIsAds(l)&&this.getAdData(l).shadow},getAdUnit:function k(l){if(!this.sections)return null;var m=[];this.sections.forEach(function(o){m.push.apply(m,o.units)});for(var n=0;n<m.length;n++)if(this.getIsAds(m[n])&&this.getAdId(m[n])==l)return m[n];return null},nextRegisterTime:function k(){var l=Infinity,m=babelHelpers["extends"]({},this.units[0],this.units[1]);for(var n in m)if(Object.prototype.hasOwnProperty.call(m,n)){var o=m[n];if(o.trackingCode!==null&&o.visible)l=Math.min(l,this.UNITS_REGISTER_DELAY-o.totalTime)}return l},getHeight:function k(l,m){var n=c("DataStore").get(l,"height");if(n&&n.x===m)return n.y;return this.cacheHeight(l,m)},cacheHeight:function k(l,m){var n={x:m,y:l.offsetHeight};c("DataStore").set(l,"height",n);return n.y},loadAdsAndEgo:function k(){if(this.loadQuery){this.resetEvents();this.addEvent("adsRequested",true);this.position++;var l=this.getCursorFBID(this.loadQuery);c("UIPagelet").loadFromEndpoint("WebEgoPane",this.root,{pid:34,data:[this.loadQuery.set,l,false,this.snowlift.getOpaqueCursor(l)]},{crossPage:true,bundle:false})}},getCursorFBID:function k(l){if(l){if(l.v!==undefined)return l.v;if(l.fbid!==undefined)return l.fbid}return"0"},unitsLoaded:function k(l,m){__p&&__p();var n;if(m){n="/ai.php";this.addEvent("adsLoaded",true)}else{n="/ajax/ei.php";this.addEvent("egoLoaded",true)}var o={};for(var p in l)if(Object.prototype.hasOwnProperty.call(l,p))o[p]={trackingCode:l[p],totalTime:0,lastShowTime:0,heightBelow:-1e4,visible:false,registerUrl:n};this.units[m]=o;if(this.units[0]&&this.units[1])this.waitForImages(this.imagesLoaded.bind(this))},imagesLoaded:function k(){this.prepareResize();this.addEvent("imagesLoaded",true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();c("CSS").removeClass(this.root,"loading")},loadAdsFromUserActivity:function k(){var l=Date.now()-this.lastLoadTime;if(!this.isLoading&&l>j.REFRESH_RATE){c("CSS").addClass(this.root,"loading");this.isLoading=true;this.loadAdsAndEgo()}},registerImpression:function k(l,m){var n=c("DOM").create("iframe",{src:new(c("URI"))(m).addQueryData({aed:l}),width:0,height:0,frameborder:0,scrolling:"no",className:"fbEmuTracking"});n.setAttribute("aria-hidden","true");c("DOM").appendContent(this.root,n)},waitForImages:function k(l){__p&&__p();var m=c("DOM").scry(this.root,"img.img"),n=m.length,o=n;if(o===0)l();var p=function p(){o--;if(o===0)setTimeout(l,0)};for(var q=0;q<n;q++){var r=m[q];if(r.complete)p();else c("Event").listen(r,{load:p,error:p,abort:p})}}};f.exports=j}),null);
__d("PhotoSnowliftBackLink.react",["cx","React"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("React").PropTypes;i=babelHelpers.inherits(l,c("React").Component);j=i&&i.prototype;l.prototype.render=function(){return c("React").createElement("a",{className:"_1cac"+(this.props.visible?" _1cad":""),href:this.props.href},this.props.name)};function l(){i.apply(this,arguments)}l.propTypes={href:k.string,name:k.string,visible:k.bool};f.exports=l}),null);
__d("PhotoSnowliftViewable",["cx","CSS","DOM","EventEmitter","Vector"],(function a(b,c,d,e,f,g,h){__p&&__p();var i,j,k=2e3;i=babelHelpers.inherits(l,c("EventEmitter"));j=i&&i.prototype;function l(){__p&&__p();var m=arguments.length<=0||arguments[0]===undefined?k:arguments[0],n=arguments.length<=1||arguments[1]===undefined?1:arguments[1];"use strict";j.constructor.call(this);this.$PhotoSnowliftViewable5=c("DOM").create("div",{className:"_2-sx"});this.$PhotoSnowliftViewable4=m;this.$PhotoSnowliftViewable3=n;this.$PhotoSnowliftViewable1=null;this.$PhotoSnowliftViewable2=0;this.$PhotoSnowliftViewable6();setTimeout(function(){return this.whenReady(function(){return this.$PhotoSnowliftViewable7()}.bind(this))}.bind(this),0)}l.prototype.$PhotoSnowliftViewable6=function(){"use strict";this.$PhotoSnowliftViewable1=setTimeout(function(){return this.$PhotoSnowliftViewable8()}.bind(this),this.$PhotoSnowliftViewable4)};l.prototype.$PhotoSnowliftViewable8=function(){"use strict";if(this.isReady())return;if(this.$PhotoSnowliftViewable2<this.$PhotoSnowliftViewable3){this.reload();this.$PhotoSnowliftViewable2++;this.$PhotoSnowliftViewable6()}else this.emit("loadingfailed")};l.prototype.reload=function(){"use strict"};l.prototype.$PhotoSnowliftViewable7=function(){"use strict";if(this.$PhotoSnowliftViewable1!==null){clearTimeout(this.$PhotoSnowliftViewable1);this.$PhotoSnowliftViewable1=null}};l.prototype.getElement=function(){"use strict";return this.$PhotoSnowliftViewable5};l.prototype.show=function(){"use strict";c("CSS").show(this.getElement())};l.prototype.hide=function(){"use strict";c("CSS").hide(this.getElement())};l.prototype.suspend=function(){"use strict"};l.prototype.resume=function(){"use strict"};l.prototype.onToggleIntoFullScreen=function(){"use strict"};l.prototype.onToggleOutOfFullScreen=function(){"use strict"};l.prototype.onEnterFullScreen=function(){"use strict"};l.prototype.onExitFullScreen=function(){"use strict"};l.prototype.getNaturalDimensions=function(){"use strict";return this.getDimensions()};l.prototype.getDimensions=function(){"use strict";return c("Vector").getElementDimensions(this.getElement())};l.prototype.setDimensions=function(m){"use strict";var n=this.getElement();n.style.width=m.x+"px";n.style.height=m.y+"px"};l.prototype.isReady=function(){"use strict";throw new Error("Viewable has no concept of readiness - should be calling a subclass")};l.prototype.whenReady=function(m){"use strict";if(this.isReady())setTimeout(m,0);else this.once("ready",m)};f.exports=l}),null);
__d("PhotoSnowliftViewableImageWrapper",["Event","EventProfiler","ImageUtils","PhotoSnowliftViewable","TimeSlice","Vector"],(function a(b,c,d,e,f,g){__p&&__p();var h,i;h=babelHelpers.inherits(j,c("PhotoSnowliftViewable"));i=h&&h.prototype;function j(k){"use strict";__p&&__p();i.constructor.call(this);c("EventProfiler").tagCurrentActiveInteractionsAs("PSVImageWrapper");this.$PhotoSnowliftViewableImageWrapper1=k;this.getElement().appendChild(k);if(this.$PhotoSnowliftViewableImageWrapper1.complete)this.$PhotoSnowliftViewableImageWrapper2();else{var l=c("TimeSlice").getGuardedContinuation("PhotoSnowLiftViewable photo load");c("Event").listen(this.$PhotoSnowliftViewableImageWrapper1,"load",l.bind(null,function(){return this.$PhotoSnowliftViewableImageWrapper2()}.bind(this)))}}j.prototype.$PhotoSnowliftViewableImageWrapper2=function(){"use strict";this.emit("ready");c("EventProfiler").informPointOnActiveInteractions("snowlift_image_loaded",{isPointOfInterest:true},true)};j.prototype.isReady=function(){"use strict";return c("ImageUtils").hasLoaded(this.$PhotoSnowliftViewableImageWrapper1)};j.prototype.getNaturalDimensions=function(){"use strict";if(this.$PhotoSnowliftViewableImageWrapper1&&this.$PhotoSnowliftViewableImageWrapper1.naturalWidth&&this.$PhotoSnowliftViewableImageWrapper1.naturalHeight)return c("Vector").from(this.$PhotoSnowliftViewableImageWrapper1.naturalWidth,this.$PhotoSnowliftViewableImageWrapper1.naturalHeight);return i.getNaturalDimensions.call(this)};f.exports=j}),null);
__d("PhotoSnowliftViewablePhoto",["Bootloader","DOM","EncryptedImg","Event","EventProfiler","ImageUtils","JSReliabilityFixesGatingConfig","PhotoSnowliftViewable","TimeSlice","Vector","WebSpeedJSExperiments"],(function a(b,c,d,e,f,g){__p&&__p();var h,i;function j(m,n){var o;if(m.src&&m.complete)setTimeout(n,0);else(function(){var p=c("Event").listen(m,"load",function(){p.remove();n()})})()}function k(m,n){if(c("EncryptedImg").isEncrypted(n))c("EncryptedImg").insertIntoDOM(n,m);else m.src=n}h=babelHelpers.inherits(l,c("PhotoSnowliftViewable"));i=h&&h.prototype;function l(m,n){__p&&__p();var o=arguments.length<=2||arguments[2]===undefined?false:arguments[2],p=arguments[3],q=arguments[4],r=arguments.length<=5||arguments[5]===undefined?false:arguments[5],s=arguments.length<=6||arguments[6]===undefined?false:arguments[6],t=arguments[7],u=arguments.length<=8||arguments[8]===undefined?false:arguments[8];"use strict";i.constructor.call(this);c("EventProfiler").tagCurrentActiveInteractionsAs("PSVPhoto");this.$PhotoSnowliftViewablePhoto2=p;this.$PhotoSnowliftViewablePhoto7=m;this.$PhotoSnowliftViewablePhoto6=n;this.$PhotoSnowliftViewablePhoto3=o;this.$PhotoSnowliftViewablePhoto1=t;this.$PhotoSnowliftViewablePhoto8=q;this.$PhotoSnowliftViewablePhoto9=r;this.$PhotoSnowliftViewablePhoto10=s;this.$PhotoSnowliftViewablePhoto11=u;this.addListener("imageloaded",function(v){return this.$PhotoSnowliftViewablePhoto13(v)}.bind(this));this.$PhotoSnowliftViewablePhoto14()}l.prototype.$PhotoSnowliftViewablePhoto14=function(){"use strict";__p&&__p();if(this.$PhotoSnowliftViewablePhoto4&&this.$PhotoSnowliftViewablePhoto4.parentElement)this.$PhotoSnowliftViewablePhoto4.parentElement.removeChild(this.$PhotoSnowliftViewablePhoto4);var m=c("DOM").create("img",{className:"spotlight",alt:this.$PhotoSnowliftViewablePhoto1});if(this.$PhotoSnowliftViewablePhoto2)this.$PhotoSnowliftViewablePhoto2.setElementDimensions(m);this.$PhotoSnowliftViewablePhoto4=m;this.$PhotoSnowliftViewablePhoto4.setAttribute("aria-busy","true");this.getElement().appendChild(this.$PhotoSnowliftViewablePhoto4);this.$PhotoSnowliftViewablePhoto12=c("TimeSlice").getGuardedContinuation("PhotoSnowliftViewable image load");this.$PhotoSnowliftViewablePhoto15(this.$PhotoSnowliftViewablePhoto16());j(this.$PhotoSnowliftViewablePhoto4,this.$PhotoSnowliftViewablePhoto12.bind(undefined,function(){this.emit("imageloaded",m);if(!c("WebSpeedJSExperiments").minimum_snowlift)c("EventProfiler").informPointOnActiveInteractions("snowlift_image_loaded",{isPointOfInterest:true},true)}.bind(this)));this.whenReady(function(){return this.$PhotoSnowliftViewablePhoto17()}.bind(this));this.$PhotoSnowliftViewablePhoto18();this.$PhotoSnowliftViewablePhoto19()};l.prototype.$PhotoSnowliftViewablePhoto19=function(){"use strict";if(this.$PhotoSnowliftViewablePhoto10&&!this.$PhotoSnowliftViewablePhoto9)c("Bootloader").loadModules(["PhotoSnowliftViewableWithContextMenuLogging"],function(m){var n=m.setupContextMenuLogging;n(this.getElement(),this.$PhotoSnowliftViewablePhoto8)}.bind(this),"PhotoSnowliftViewablePhoto")};l.prototype.$PhotoSnowliftViewablePhoto18=function(){"use strict";if(!this.$PhotoSnowliftViewablePhoto11)return;c("Bootloader").loadModules(["PhotoSnowliftViewableWithShieldIconOverlay"],function(m){var n=m.setupShieldIconOverlay;n(this.getElement())}.bind(this),"PhotoSnowliftViewablePhoto")};l.prototype.$PhotoSnowliftViewablePhoto15=function(m){"use strict";this.$PhotoSnowliftViewablePhoto5=m;k(this.$PhotoSnowliftViewablePhoto4,this.$PhotoSnowliftViewablePhoto5)};l.prototype.$PhotoSnowliftViewablePhoto13=function(m){"use strict";if(this.$PhotoSnowliftViewablePhoto4!==m)return;this.emit("ready")};l.prototype.reload=function(){"use strict";this.$PhotoSnowliftViewablePhoto12&&c("TimeSlice").cancel(this.$PhotoSnowliftViewablePhoto12);this.$PhotoSnowliftViewablePhoto14()};l.prototype.$PhotoSnowliftViewablePhoto16=function(){"use strict";if(this.$PhotoSnowliftViewablePhoto3)return this.$PhotoSnowliftViewablePhoto7;return this.$PhotoSnowliftViewablePhoto6||this.$PhotoSnowliftViewablePhoto7};l.prototype.$PhotoSnowliftViewablePhoto17=function(){"use strict";this.$PhotoSnowliftViewablePhoto4.setAttribute("aria-busy","false")};l.prototype.isReady=function(){"use strict";return this.$PhotoSnowliftViewablePhoto4.src&&c("ImageUtils").hasLoaded(this.$PhotoSnowliftViewablePhoto4)};l.prototype.getNaturalDimensions=function(){"use strict";if(this.$PhotoSnowliftViewablePhoto2)return this.$PhotoSnowliftViewablePhoto2;if(this.$PhotoSnowliftViewablePhoto4&&this.$PhotoSnowliftViewablePhoto4.naturalWidth&&this.$PhotoSnowliftViewablePhoto4.naturalHeight)return c("Vector").from(this.$PhotoSnowliftViewablePhoto4.naturalWidth,this.$PhotoSnowliftViewablePhoto4.naturalHeight);return i.getNaturalDimensions.call(this)};l.prototype.$PhotoSnowliftViewablePhoto20=function(){"use strict";return this.$PhotoSnowliftViewablePhoto5===this.$PhotoSnowliftViewablePhoto7};l.prototype.onToggleIntoFullScreen=function(){"use strict";if(!this.$PhotoSnowliftViewablePhoto20())if(this.$PhotoSnowliftViewablePhoto5!==this.$PhotoSnowliftViewablePhoto7)k(new Image(),this.$PhotoSnowliftViewablePhoto7)};l.prototype.onEnterFullScreen=function(){"use strict";if(!this.$PhotoSnowliftViewablePhoto20())this.$PhotoSnowliftViewablePhoto15(this.$PhotoSnowliftViewablePhoto7)};f.exports=l}),null);
__d("SphericalMediaActions",[],(function a(b,c,d,e,f,g){"use strict";f.exports={TURN_ON:"TURN_ON",TURN_OFF:"TURN_OFF",ENABLE_SPHERICAL:"ENABLE_SPHERICAL",DISABLE_SPHERICAL:"DISABLE_SPHERICAL",REQUEST_PHOTO_FAILED:"REQUEST_PHOTO_FAILED",REQUEST_PHOTO:"REQUEST_PHOTO",RECEIVE_PHOTO:"RECEIVE_PHOTO",UPDATE_BASE:"UPDATE_BASE",DRAG_START:"DRAG_START",GYRO_START:"GYRO_START",ZOOM_START:"ZOOM_START",SIGNIFICANT_MOVE:"SIGNIFICANT_MOVE",MOUSE_ANIMATION_START:"MOUSE_ANIMATION_START",MOUSE_ENTER:"MOUSE_ENTER",TAP_HEADING_INDICATOR:"TAP_HEADING_INDICATOR",VIEWPORT_CLICKED:"VIEWPORT_CLICKED",VISIBILITY_CHANGED:"VISIBILITY_CHANGED",UPDATE_DIMENSION:"UPDATE_DIMENSION",UPDATE_INITIAL_FOV:"UPDATE_INITIAL_FOV",UPDATE_INITIAL_VIEWPORT:"UPDATE_INITIAL_VIEWPORT",SETUP_RENDERER:"SETUP_RENDERER",WEBGL_CONTEXT_LOST:"WEBGL_CONTEXT_LOST",WEBGL_INIT_FAILED:"WEBGL_INIT_FAILED",WEBGL_RENDER_FAILED:"WEBGL_RENDER_FAILED",SOURCE_ONLOAD:"SOURCE_ONLOAD",REPLACE_BASE_STATE:"REPLACE_BASE_STATE",UPDATE_CTR_ELEM:"UPDATE_CTR_ELEM",SHOW_FALLBACK:"SHOW_FALLBACK",FALLBACK_MOUSE_OVER:"FALLBACK_MOUSE_OVER",FALLBACK_MOUSE_OUT:"FALLBACK_MOUSE_OUT",FALLBACK_INDICATOR_MOUSE_OVER:"FALLBACK_INDICATOR_MOUSE_OVER",FALLBACK_INDICATOR_MOUSE_OUT:"FALLBACK_INDICATOR_MOUSE_OUT",UPDATE_PARTIAL_LIMITS:"UPDATE_PARTIAL_LIMITS",USE_FALLBACK:"USE_FALLBACK",UPDATE_VIEW:"UPDATE_VIEW",UPDATE_VIEWPORT:"UPDATE_VIEWPORT",UPDATE_FOV:"UPDATE_FOV",UPDATE_YAW:"UPDATE_YAW",UPDATE_VIEWPORT_AND_FOV:"UPDATE_VIEWPORT_AND_FOV",START_ANIMATING:"START_ANIMATING",STOP_ANIMATING:"STOP_ANIMATING",UPDATE_PHOTO_EDIT:"UPDATE_PHOTO_EDIT",CANCEL_EDITING:"CANCEL_EDITING",START_EDITING:"START_EDITING",STOP_EDITING:"STOP_EDITING",UPDATE_PHOTO:"UPDATE_PHOTO",UPDATE_PHOTO_FAILED:"UPDATE_PHOTO_FAILED",UPDATE_PHOTO_DONE:"UPDATE_PHOTO_DONE",UPDATE_RENDERER_PROJECTION_TYPE:108,UPDATE_RENDERER_PROJECTION_TYPE_FAILED:109,UPDATE_RENDERER_PROJECTION_TYPE_DONE:110,RESET_MOUSE_ANIMATION:"RESET_MOUSE_ANIMATION",START_MOUSE_ANIMATION:"START_MOUSE_ANIMATION",STOP_MOUSE_ANIMATION:"STOP_MOUSE_ANIMATION",DISABLE_SPHERICAL_ON_SAVE:"DISABLE_SPHERICAL_ON_SAVE",ENABLE_SPHERICAL_ON_SAVE:"ENABLE_SPHERICAL_ON_SAVE",ENABLE_EDITING:"ENABLE_EDITING",DISABLE_EDITING:"DISABLE_EDITING",TAKE_STATE_SNAPSHOT:"TAKE_STATE_SNAPSHOT",RESTORE_EDIT_STATE_FROM_SNAPSHOT:"RESTORE_EDIT_STATE_FROM_SNAPSHOT",RESTORE_TAGS_STATE_FROM_SNAPSHOT:"RESTORE_TAGS_STATE_FROM_SNAPSHOT",REMOVE_STATE_SNAPSHOT:"REMOVE_STATE_SNAPSHOT",PHOTO_REMOVED:"PHOTO_REMOVED",UPDATE_FILE_URL:"UPDATE_FILE_URL",CANVAS_RESIZE_START:"CANVAS_RESIZE_START",CANVAS_RESIZE_IMG_LOADED:"CANVAS_RESIZE_IMG_LOADED",CANVAS_RESIZE_SUCCESS:"CANVAS_RESIZE_SUCCESS",CANVAS_RESIZE_FAILED:"CANVAS_RESIZE_FAILED",OPEN_TAG_DIALOG:"OPEN_TAG_DIALOG",CLOSE_TAG_DIALOG:"CLOSE_TAG_DIALOG",SAVE_DIALOG_TAGS:"SAVE_DIALOG_TAGS",CANCEL_DIALOG_TAG_CHANGES:"CANCEL_DIALOG_TAG_CHANGES",PHOTO_RENDERER_STATS:"PHOTO_RENDERER_STATS",ENABLE_TAGGING:"ENABLE_TAGGING",DISABLE_TAGGING:"DISABLE_TAGGING",UPDATE_SPATIAL_TAGS:"UPDATE_SPATIAL_TAGS",UPDATE_SPATIAL_TAGS_FROM_COMPOSER:"UPDATE_SPATIAL_TAGS_FROM_COMPOSER",UPDATE_TAG_UNDER_MOUSE:"UPDATE_TAG_UNDER_MOUSE",TAGGING_START:"TAGGING_START",TAGGING_STOP:"TAGGING_STOP",UPDATE_TAG_CLICKED:"UPDATE_TAG_CLICKED",UPDATE_TAGGER:"UPDATE_TAGGER",ENTER_TAGGING_MODE:"ENTER_TAGGING_MODE",EXIT_TAGGING_MODE:"EXIT_TAGGING_MODE",UPDATE_TARGETED_TAG:"UPDATE_TARGETED_TAG",REDIRECT_FROM_CLICKED_TAG:"REDIRECT_FROM_CLICKED_TAG",DELETED_SPATIAL_TAG:"DELETED_SPATIAL_TAG",ADD_SPATIAL_TAG_FROM_PHOTO_TAGGER:"ADD_SPATIAL_TAG_FROM_PHOTO_TAGGER"}}),null);
__d("SphericalMediaActionNamespaces",[],(function a(b,c,d,e,f,g){"use strict";f.exports={BASE:"BASE",CORE:"CORE",PHOTO:"PHOTO",PHOTO_EDIT:"PHOTO_EDIT",VIEW:"VIEW"}}),null);
__d("SphericalMediaBaseActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();f.exports={updateBase:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_BASE,data:i}},dragStart:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").DRAG_START}},gyroStart:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").GYRO_START}},mouseAnimationStart:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").MOUSE_ANIMATION_START}},mouseEnter:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").MOUSE_ENTER}},tapHeadingIndicator:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").TAP_HEADING_INDICATOR}},significantMove:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").SIGNIFICANT_MOVE,data:{view:i}}},viewportClicked:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").VIEWPORT_CLICKED}},visibilityChanged:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").VISIBILITY_CHANGED,data:i}},zoomStart:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").ZOOM_START}},updateDimension:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_DIMENSION,data:{width:i,height:j}}},updateInitialViewport:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_INITIAL_VIEWPORT,data:{initialYaw:i,initialPitch:j}}},updateInitialFOV:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_INITIAL_FOV,data:{initialFov:i}}},setupRenderer:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").SETUP_RENDERER,data:{renderer:i,dt:j}}},webGlInitFailed:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").WEBGL_INIT_FAILED,data:{error:i}}},webGlRenderFailed:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").WEBGL_RENDER_FAILED,data:{error:i,view:j}}},webGlContextLost:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").WEBGL_CONTEXT_LOST}},sourceOnLoad:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").SOURCE_ONLOAD}},replaceBaseState:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").REPLACE_BASE_STATE,data:i}},updateSpatialTags:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_SPATIAL_TAGS,data:i}},updateSpatialTagsFromComposer:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_SPATIAL_TAGS_FROM_COMPOSER,data:i}},updateTagUnderMouse:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_TAG_UNDER_MOUSE,data:i}},updateFileURL:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_FILE_URL,data:i}},canvasResizeStart:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").CANVAS_RESIZE_START}},canvasResizeImgLoaded:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").CANVAS_RESIZE_IMG_LOADED,data:{width:i,height:j}}},canvasResizeSuccess:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").CANVAS_RESIZE_SUCCESS,data:i}},canvasResizeFailed:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").CANVAS_RESIZE_FAILED,data:i}},enableTagging:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").ENABLE_TAGGING}},disableTagging:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").DISABLE_TAGGING}},taggingStart:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").TAGGING_START}},taggingStop:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").TAGGING_STOP}},updateTagClicked:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_TAG_CLICKED,data:i}},updateTagger:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_TAGGER,data:i}},enterTaggingMode:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").ENTER_TAGGING_MODE}},exitTaggingMode:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").EXIT_TAGGING_MODE}},updateTargetedTag:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_TARGETED_TAG,data:i}},redirectFromClickedTag:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").REDIRECT_FROM_CLICKED_TAG}},deletedSpatialTag:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").DELETED_SPATIAL_TAG}},addSpatialTagFromPhotoTagger:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").ADD_SPATIAL_TAG_FROM_PHOTO_TAGGER}},updateCtrElem:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_CTR_ELEM,data:{element:i}}},showFallbackUI:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").SHOW_FALLBACK}},requestPhoto:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").REQUEST_PHOTO}},requestPhotoFailed:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").REQUEST_PHOTO_FAILED,data:{id:i,error:j}}},receivePhoto:function h(i,j){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").RECEIVE_PHOTO,data:j}},updatePartialLimits:function h(i){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").UPDATE_PARTIAL_LIMITS,data:i}},useFallbackUI:function h(){return{namespace:c("SphericalMediaActionNamespaces").BASE,type:c("SphericalMediaActions").USE_FALLBACK}}}}),null);
__d("SphericalMediaConstants",[],(function a(b,c,d,e,f,g){"use strict";var h={COMP_PHOTO_EDIT_THUMB:"PhotoEditThumbanil",COMP_PHOTO_VIEWER:"PhotoViewer",EDIT_VIEWPORT_SIZE:{width:476,height:476},HI_ALPHA_BG:{start:.2,end:.5},HI_ALPHA_ELEMENT:{start:.5,end:.85},HI_ALPHA_DURATION:400,HI_SIZE_NORMAL:{width:35,height:35,center_radius:2,background_radius:17.5,inner_radius:12,arc_radius:6.3,arc_stroke:5.3,inner_stroke:1,triangle:[2,2.5,5.2],rim_radius:16.8,rim_stroke:1.4},HI_SIZE_FULL:{width:50,height:50,center_radius:3,background_radius:25,inner_radius:17.14,arc_radius:9,arc_stroke:7.57,inner_stroke:1.5,triangle:[2.85,4.29,7.9],rim_radius:24,rim_stroke:2},HI_BLINK_ARC_RAD:Math.PI/6,HI_BLINK_DURATION:400,HI_FADE_OUT_DELAY:1e3,MOUSE_EXPOSURE:4e3,LOGGER_SURFACES:{newsfeed:"newsfeed",timeline:"timeline",fullpage:"photo_viewer",snowlift:"www_snowlift",composer:"composer",albumComposer:"album_composer",other:"other"},LOGGER_SIGNIFICANT_MOVEMENT_DEGREE:30,LOGGER_SIGNIFICANT_MOVEMENT_MS:1e3,GYRO_SLIP_FACTOR:.15,RB_SPRING_FACTOR:25,RB_MAX_SPRING_DEGREE:15,RB_MAX_STRETCH_X_DEGREE:20,RB_MAX_STRETCH_Y_DEGREE:20,RB_FRICTION:.3,TILED_CUBE_FACES:{PLUS_X:2,MINUS_X:0,PLUS_Y:4,MINUS_Y:5,PLUS_Z:3,MINUS_Z:1},TILED_CUBE_TILE_CONTENT_SIZE:510,TILED_CUBE_TILE_PADDING_PIXELS:1,TAG:"tag",TAGGED_FACEBOX:"tagged_facebox",UNTAGGED_FACEBOX:"untagged_facebox",DEFAULT_SPATIAL_TAG_SIZE_DEGREE:10};f.exports=h}),null);
__d("SphericalMediaBootloaded.react",["cx","BootloadedComponent.react","JSResource","LoadingIndicator.react","React","SphericalMediaConstants"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalMediaConstants").COMP_PHOTO_EDIT_THUMB,l=c("SphericalMediaConstants").COMP_PHOTO_VIEWER,m=function m(o,p){return c("React").createElement("div",{className:o,style:p},c("React").createElement(c("LoadingIndicator.react"),{className:"_4qlq",size:"small",color:"white"}))};i=babelHelpers.inherits(n,c("React").PureComponent);j=i&&i.prototype;n.prototype.render=function(){var o=void 0;switch(this.props.componentName){case k:var p=this.props.loadingElement||m("_7d7",{width:this.props.width,height:this.props.height});return c("React").createElement(c("BootloadedComponent.react"),babelHelpers["extends"]({bootloadLoader:c("JSResource")("SphericalPhotoEditThumbnail.react").__setRef("SphericalMediaBootloaded.react"),bootloadPlaceholder:p},this.props));case l:o=c("React").createElement("div",null);return c("React").createElement(c("BootloadedComponent.react"),babelHelpers["extends"]({bootloadLoader:c("JSResource")("SphericalPhotoViewer.react").__setRef("SphericalMediaBootloaded.react"),bootloadPlaceholder:o},this.props));default:return null}};function n(){i.apply(this,arguments)}f.exports=n}),null);
__d("SphericalMediaGyroOverlay.react",["cx","CSS","React","ReactDOM","joinClasses"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=800,l=function l(n){var o=arguments.length<=1||arguments[1]===undefined?true:arguments[1],p=arguments.length<=2||arguments[2]===undefined?false:arguments[2];return{gyroRoot:"_1zvy"+(n?" _2dz7":"")+(o?" _4z8s":"")+(p?" _4z8p":""),gyroOuter:"_4z8q",gyroInner:"_4z8r",gyroMeridian:"_4z8t",gyroEquator:"_4z8u",gyroTextShell:"_4z8v",gyroText:"_4z8w"}};i=babelHelpers.inherits(m,c("React").PureComponent);j=i&&i.prototype;m.prototype.componentDidUpdate=function(n){__p&&__p();if(n.isActive&&!this.props.isActive)setTimeout(function(){var o=c("ReactDOM").findDOMNode(this);if(o instanceof Element)c("CSS").hide(o)}.bind(this),k);else if(!this.props.isActive){var o=c("ReactDOM").findDOMNode(this);if(o instanceof Element)c("CSS").hide(o)}};m.prototype.componentDidMount=function(){if(!this.props.isActive){var n=c("ReactDOM").findDOMNode(this);if(n instanceof Element)c("CSS").hide(n)}};m.prototype.render=function(){var n=this.props,o=n.className,p=n.isActive,q=n.isInfinite,r=n.isPaused,s=l(p,q,r);return c("React").createElement("div",{className:c("joinClasses")(o,s.gyroRoot)},c("React").createElement("div",{className:s.gyroOuter},c("React").createElement("div",{className:s.gyroInner},c("React").createElement("div",{className:s.gyroMeridian}),c("React").createElement("div",{className:s.gyroEquator})),c("React").createElement("div",{className:s.gyroTextShell},c("React").createElement("span",{className:s.gyroText},"360"))))};function m(){i.apply(this,arguments)}f.exports=m}),null);
__d("SphericalPhotoPlaceHolderWithGyroOverlay.react",["cx","BackgroundImage.react","Image.react","React","SphericalMediaGyroOverlay.react"],(function a(b,c,d,e,f,g,h){"use strict";var i,j;i=babelHelpers.inherits(k,c("React").PureComponent);j=i&&i.prototype;k.prototype.render=function(){return c("React").createElement("div",{className:"_5nxw _1c1o"},this.props.showNewRenderer?c("React").createElement(c("BackgroundImage.react"),{backgroundSize:"contain",height:this.props.height,src:this.props.placeholderImageURL,width:this.props.width}):c("React").createElement(c("Image.react"),{className:"_1c1p",height:this.props.height,src:this.props.placeholderImageURL,width:this.props.width}),c("React").createElement(c("SphericalMediaGyroOverlay.react"),{className:"_1c1q",isActive:true}))};function k(){i.apply(this,arguments)}f.exports=k}),null);
__d("SphericalPhotoViewerLogEvents",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({CDN_IMAGE_FAILURE:"spherical_photo_cdn_image_failure",CUBE_LOAD_TIME:"spherical_photo_cube_load_time",DRAG_MOUSE_ANIMATION:"spherical_photo_drag_mouse_animation",DRAG_START:"spherical_photo_drag_start",ENTER_FULLSCREEN:"spherical_photo_tap_feed_to_fullscreen",EXIT_FULLSCREEN:"spherical_photo_fullscreen_exited",FALLBACK_LEARNMORE:"spherical_photo_fallback_learnmore",FALLBACK_PREVIEW:"spherical_photo_fallback_preview",FEED_VP_ENTERED:"spherical_photo_feed_vp_entered",FEED_VP_EXITED:"spherical_photo_feed_vp_exited",LOADED:"spherical_photo_loaded",MOUSEOVER_START:"spherical_photo_mouseover_start",PHONE_PAN_ANIMATION:"spherical_photo_phone_pan_animation",RENDER_FRAME_RATE:"spherical_photo_render_frame_rate",RENDERER_SETUP:"spherical_photo_renderer_setup",RENDERER_STATS:"spherical_photo_renderer_stats",SHOW_VIEW_IN_VR:"spherical_photo_show_view_in_vr",SIGNIFICANT_MOVEMENT:"spherical_photo_significant_movement",TAP_HEADING_INDICATOR:"spherical_photo_tap_heading_indicator",TAP_VIEW_IN_VR:"spherical_photo_tap_view_in_vr",WEBGL_CONTEXT_LOST:"spherical_photo_webgl_context_lost",WEBGL_INIT_FAILURE:"spherical_photo_webgl_init_failure",WEBGL_RENDER_FAILURE:"spherical_photo_webgl_render_failure",M_SENSOR_SETUP_FAILURE:"spherical_photo_m_sensor_setup_failure",WWW_ENTER_SNOWLIFT:"spherical_photo_www_enter_snowlift",WWW_EXIT_SNOWLIFT:"spherical_photo_www_exit_snowlift",WWW_GYRO_START:"spherical_photo_www_gyro_start",ZOOM_START:"spherical_photo_zoom_start",INITIAL_VIEW_MODIFIED:"spherical_photo_initial_view_modified",POST_EVENT:"spherical_photo_post_event",TOGGLE_OFF:"spherical_photo_toggle_off",TOGGLE_ON:"spherical_photo_toggle_on",WWW_IVS_OPEN:"spherical_photo_www_ivs_open",WWW_IVS_CANCEL:"spherical_photo_www_ivs_cancel",WWW_IVS_ENABLE_ON_SAVE:"spherical_photo_www_ivs_enable_on_save",WWW_IVS_DISABLE_ON_SAVE:"spherical_photo_www_ivs_disable_on_save",WWW_IVS_REQUEST_DONE:"spherical_photo_www_ivs_request_done",WWW_IVS_REQUEST_FAILED:"spherical_photo_www_ivs_request_failed",WWW_IVS_REQUEST_START:"spherical_photo_www_ivs_request_start",WWW_IVS_UPDATE_DONE:"spherical_photo_www_ivs_update_done",WWW_IVS_UPDATE_FAILED:"spherical_photo_www_ivs_update_failed",WWW_IVS_UPDATE_START:"spherical_photo_www_ivs_update_start",SERVER_IVS_UPDATE_DONE:"spherical_photo_server_ivs_update_done",SERVER_IVS_UPDATE_FAILED:"spherical_photo_server_ivs_update_failed",SERVER_IVS_UPDATE_START:"spherical_photo_server_ivs_update_start",DRAG_START_DEPRECATED:"drag_start_360_photo",PHONE_PAN_ANIMATION_DEPRECATED:"phone_pan_animation_360_photo",SHOW_VIEW_IN_VR_DEPRECATED:"show_360_photo_view_in_vr",SIGNIFICANT_MOVEMENT_DEPRECATED:"significant_movement_360_photo",TAP_FEED_TO_FULLSCREEN_DEPRECATED:"tap_360_photo_feed_to_fullscreen",TAP_HEADING_INDICATOR_DEPRECATED:"tap_360_photo_heading_indicator",TAP_VIEW_IN_VR_DEPRECATED:"tap_360_photo_view_in_vr",ZOOM_START_DEPRECATED:"zoom_start_360_photo"})}),null);
__d("SphericalPhotoViewerLoggerUtil",["Bootloader","CSS","FullScreen","ProfileTabUtils","SphericalPhotoViewerLogEvents","SphericalPhotoViewerTypedLogger","URI","SphericalMediaConstants"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h="timelineLayout",i=c("SphericalMediaConstants").LOGGER_SURFACES,j=function j(l){__p&&__p();if(c("FullScreen").isFullScreen())return i.fullpage;var m=c("URI").getMostRecentURI();if(Object.prototype.hasOwnProperty.call(m.getQueryData(),"theater"))return i.snowlift;if(m.getPath()==="/"||m.getPath()==="/home.php")return i.newsfeed;var n=l.getTabKeyFromURI(m),o=l.getVanityFromURI(m);if(o&&c("ProfileTabUtils").isTimelineTab(n)&&document.body&&c("CSS").hasClass(document.body,h))return i.timeline;return i.other},k={logTapHeadingIndicator:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").TAP_HEADING_INDICATOR,m)},logDragStart:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").DRAG_START,m)},logMouseOverStart:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").MOUSEOVER_START,m)},logWWWGyroStart:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_GYRO_START,m)},logZoomStart:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").ZOOM_START,m)},logDragMouseAnimation:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").DRAG_MOUSE_ANIMATION,m)},logEnterSnowlift:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_ENTER_SNOWLIFT,m)},logExitSnowlift:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_EXIT_SNOWLIFT,m)},logEnterFullScreen:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").ENTER_FULLSCREEN,m)},logExitFullScreen:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").EXIT_FULLSCREEN,m)},logSignificantMovement:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").SIGNIFICANT_MOVEMENT,m)},logIVSOpen:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_OPEN,m)},logIVSCancel:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_CANCEL,m)},logIVSEnableSphericalOnSave:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_ENABLE_ON_SAVE,m)},logIVSDisableSphericalOnSave:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_DISABLE_ON_SAVE,m)},logToggleOn:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").TOGGLE_ON,m)},logToggleOff:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").TOGGLE_OFF,m)},logIVSRequestStart:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_REQUEST_START,m)},logIVSRequestFailed:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_REQUEST_FAILED,m)},logIVSRequestDone:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_REQUEST_DONE,m)},logIVSUpdateStart:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_UPDATE_START,m)},logIVSUpdateFailed:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_UPDATE_FAILED,m)},logIVSUpdateDone:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WWW_IVS_UPDATE_DONE,m)},logWebGlInitFailed:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],n=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];k._log(c("SphericalPhotoViewerLogEvents").WEBGL_INIT_FAILURE,m,n)},logWebGlRenderFailed:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],n=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];k._log(c("SphericalPhotoViewerLogEvents").WEBGL_RENDER_FAILURE,m,n)},logWebGlContextLost:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").WEBGL_CONTEXT_LOST,m)},logNumberOfSphericalPhoto:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];k._log(c("SphericalPhotoViewerLogEvents").POST_EVENT,m)},logRendererSetup:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],n=arguments[1];m.renderMethod=n?"tiled":"cubestrip";k._log(c("SphericalPhotoViewerLogEvents").RENDERER_SETUP,m)},logRendererStats:function l(){var m=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],n=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];k._log(c("SphericalPhotoViewerLogEvents").RENDERER_STATS,m,n)},_log:function l(m,n){var o=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];if(!n.surface){c("Bootloader").loadModules(["TimelineURI"],function(p){n.surface=j(p);k._logWithSurface(m,n,o)},"SphericalPhotoViewerLoggerUtil");return}k._logWithSurface(m,n,o)},_logWithSurface:function l(m,n){var o=arguments.length<=2||arguments[2]===undefined?{}:arguments[2];new(c("SphericalPhotoViewerTypedLogger"))().setComposerSessionID(n.composerSessionID).setDt(n.dt).setErrorMessage(n.errorMessage).setName(m).setNumberOfSphericalPhoto(n.numberOfSphericalPhoto).setPhotoID(n.photoID).setPitch(n.pitch).setRenderMethod(n.renderMethod||"").setSphericalPhotoSessionID(n.sessionID).setSurface(n.surface).setVfov(n.vfov).setViewportHeight(n.viewportHeight).setViewportWidth(n.viewportWidth).setYaw(n.yaw).updateData(o).log()}};f.exports=k}),null);
__d("PhotoSnowliftViewableSphericalPhoto",["cx","Arbiter","Bootloader","CSS","DOM","DOMQuery","EventProfiler","React","ReactDOM","SphericalMediaActions","SphericalMediaBootloaded.react","SphericalPhotoConfig","SphericalPhotoPlaceHolderWithGyroOverlay.react","SubscriptionsHandler","Vector","SphericalMediaConstants","PhotoSnowliftViewable","SphericalMediaBaseActions","getViewportDimensions","SphericalPhotoViewerLoggerUtil","SphericalPhotoTypedConfig"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalMediaConstants").COMP_PHOTO_VIEWER,l=c("SphericalMediaConstants").LOGGER_SURFACES,m=c("SphericalMediaConstants").UNTAGGED_FACEBOX,n=c("SphericalMediaBaseActions").deletedSpatialTag,o=c("SphericalMediaBaseActions").enterTaggingMode,p=c("SphericalMediaBaseActions").exitTaggingMode,q=c("SphericalMediaBaseActions").taggingStop,r=c("SphericalMediaBaseActions").updateDimension,s=c("SphericalMediaBaseActions").updateSpatialTags,t=c("SphericalMediaBaseActions").updateTagger,u=c("SphericalMediaBaseActions").updateTargetedTag,v=c("SphericalPhotoViewerLoggerUtil").logEnterFullScreen,w=c("SphericalPhotoViewerLoggerUtil").logEnterSnowlift,x=c("SphericalPhotoViewerLoggerUtil").logExitFullScreen,y=c("SphericalPhotoViewerLoggerUtil").logExitSnowlift,z=2e3*16,A=360;i=babelHelpers.inherits(B,c("PhotoSnowliftViewable"));j=i&&i.prototype;function B(D,E,F,G,H,I,J){__p&&__p();var K=arguments.length<=7||arguments[7]===undefined?false:arguments[7],L=arguments[8],M=arguments[9],N=arguments[10],O=arguments[11],P=arguments[12],Q=arguments[13];j.constructor.call(this,z);C.call(this);c("EventProfiler").tagCurrentActiveInteractionsAs("PSVSphericalPhoto");this.$PhotoSnowliftViewableSphericalPhoto1=F;this.$PhotoSnowliftViewableSphericalPhoto2=L;this.$PhotoSnowliftViewableSphericalPhoto5=N;this.$PhotoSnowliftViewableSphericalPhoto6=false;this.$PhotoSnowliftViewableSphericalPhoto7=K;this.$PhotoSnowliftViewableSphericalPhoto8=false;this.$PhotoSnowliftViewableSphericalPhoto9=false;this.$PhotoSnowliftViewableSphericalPhoto12=M;this.$PhotoSnowliftViewableSphericalPhoto13=O;this.$PhotoSnowliftViewableSphericalPhoto14=E;this.$PhotoSnowliftViewableSphericalPhoto15=new(c("SubscriptionsHandler"))();this.$PhotoSnowliftViewableSphericalPhoto16=G;this.$PhotoSnowliftViewableSphericalPhoto17=D;this.$PhotoSnowliftViewableSphericalPhoto18=P;this.$PhotoSnowliftViewableSphericalPhoto20=Q;this.$PhotoSnowliftViewableSphericalPhoto4=c("DOM").create("div",{className:"_zq_ _5nxw"});this.$PhotoSnowliftViewableSphericalPhoto3=c("DOM").create("div",{className:"_zr0 _5nxw"});this.getElement().appendChild(this.$PhotoSnowliftViewableSphericalPhoto4);this.getElement().appendChild(this.$PhotoSnowliftViewableSphericalPhoto3);c("CSS").addClass(this.getElement(),"_zr1");this.$PhotoSnowliftViewableSphericalPhoto10={fov:H,pitch:I,yaw:J};this.$PhotoSnowliftViewableSphericalPhoto19=new(c("SubscriptionsHandler"))();c("CSS").addClass(this.$PhotoSnowliftViewableSphericalPhoto13.stage,"_1ziy");this.$PhotoSnowliftViewableSphericalPhoto21();w(this.$PhotoSnowliftViewableSphericalPhoto22())}B.prototype.$PhotoSnowliftViewableSphericalPhoto22=function(){return{photoID:this.$PhotoSnowliftViewableSphericalPhoto5,surface:l.snowlift}};B.prototype.$PhotoSnowliftViewableSphericalPhoto23=function(D){if(this.$PhotoSnowliftViewableSphericalPhoto16.useTiledRenderer&&c("SphericalPhotoConfig").show_new_renderer)c("ReactDOM").render(c("React").createElement(c("SphericalPhotoPlaceHolderWithGyroOverlay.react"),{placeholderImageURL:this.$PhotoSnowliftViewableSphericalPhoto24(),showNewRenderer:true,width:D.x,height:D.y}),this.$PhotoSnowliftViewableSphericalPhoto3);else c("ReactDOM").render(c("React").createElement(c("SphericalPhotoPlaceHolderWithGyroOverlay.react"),{placeholderImageURL:this.$PhotoSnowliftViewableSphericalPhoto24()}),this.$PhotoSnowliftViewableSphericalPhoto3)};B.prototype.$PhotoSnowliftViewableSphericalPhoto21=function(){var D=this.$PhotoSnowliftViewableSphericalPhoto25(),E=[this.$PhotoSnowliftViewableSphericalPhoto26,this.$PhotoSnowliftViewableSphericalPhoto27,this.$PhotoSnowliftViewableSphericalPhoto28];if(c("SphericalPhotoConfig").www_can_viewer_tag)E.push(this.$PhotoSnowliftViewableSphericalPhoto29);this.$PhotoSnowliftViewableSphericalPhoto23(D);c("ReactDOM").render(c("React").createElement(c("SphericalMediaBootloaded.react"),{componentName:k,canvasNamespace:"Snowlift",cubeImageURI:this.$PhotoSnowliftViewableSphericalPhoto1,fallback:this.$PhotoSnowliftViewableSphericalPhoto20,enableGyro:true,enableZoom:true,enableTagging:true,enableRubberBanding:true,height:D.y,initialView:this.$PhotoSnowliftViewableSphericalPhoto10,photoID:this.$PhotoSnowliftViewableSphericalPhoto5,partialLimits:this.$PhotoSnowliftViewableSphericalPhoto12,photoSphereMetadata:this.$PhotoSnowliftViewableSphericalPhoto18,surface:l.snowlift,tiledSphericalConfig:this.$PhotoSnowliftViewableSphericalPhoto16,middlewares:E,width:D.x}),this.$PhotoSnowliftViewableSphericalPhoto4);this.$PhotoSnowliftViewableSphericalPhoto8=true;this.emit("ready")};B.prototype.$PhotoSnowliftViewableSphericalPhoto30=function(){this.$PhotoSnowliftViewableSphericalPhoto19.release();this.$PhotoSnowliftViewableSphericalPhoto15.release();c("ReactDOM").unmountComponentAtNode(this.$PhotoSnowliftViewableSphericalPhoto3);c("ReactDOM").unmountComponentAtNode(this.$PhotoSnowliftViewableSphericalPhoto4)};B.prototype.suspend=function(){this.$PhotoSnowliftViewableSphericalPhoto30()};B.prototype.resume=function(){this.$PhotoSnowliftViewableSphericalPhoto21()};B.prototype.reload=function(){this.$PhotoSnowliftViewableSphericalPhoto21()};B.prototype.hide=function(){if(c("CSS").shown(this.getElement()))y(this.$PhotoSnowliftViewableSphericalPhoto22());j.hide.call(this);this.$PhotoSnowliftViewableSphericalPhoto30()};B.prototype.getDimensions=function(){var D=c("getViewportDimensions")(),E=D.width,F=D.height;if(c("SphericalPhotoConfig").should_snowlift_fit_to_screen){if(!this.$PhotoSnowliftViewableSphericalPhoto6)E-=A;if(this.$PhotoSnowliftViewableSphericalPhoto12&&this.$PhotoSnowliftViewableSphericalPhoto12.partialTopDegrees||!this.isRenderReady())E=F=Math.min(E,F)}else E=F=Math.min(E,F);return c("Vector").from(E,F)};B.prototype.$PhotoSnowliftViewableSphericalPhoto25=function(){return c("Vector").getElementDimensions(this.getElement())};B.prototype.$PhotoSnowliftViewableSphericalPhoto31=function(D){var E=this.getElement().parentElement,F=new(c("Vector"))(D.x,D.y);if(E&&E instanceof HTMLElement){var G=c("Vector").getElementDimensions(E),H=c("Vector").getElementDimensions(this.getElement());if(G.x!==H.x||F.x<G.x||F.y<G.y){F.x=G.x;F.y=G.y}}return F};B.prototype.isReady=function(){return this.$PhotoSnowliftViewableSphericalPhoto8};B.prototype.isRenderReady=function(){return this.$PhotoSnowliftViewableSphericalPhoto9};B.prototype.setDimensions=function(D){j.setDimensions.call(this,this.$PhotoSnowliftViewableSphericalPhoto31(D));if(this.$PhotoSnowliftViewableSphericalPhoto16.useTiledRenderer&&c("SphericalPhotoConfig").show_new_renderer){var E=this.$PhotoSnowliftViewableSphericalPhoto25();if(!this.$PhotoSnowliftViewableSphericalPhoto9&&(!this.$PhotoSnowliftViewableSphericalPhoto2||this.$PhotoSnowliftViewableSphericalPhoto2.x!==E.x||this.$PhotoSnowliftViewableSphericalPhoto2.y!==E.y))this.$PhotoSnowliftViewableSphericalPhoto23(E);this.$PhotoSnowliftViewableSphericalPhoto2=E}this.emit("onSetDimensions")};B.prototype.onToggleIntoFullScreen=function(){};B.prototype.onEnterFullScreen=function(){if(this.$PhotoSnowliftViewableSphericalPhoto6)return;this.$PhotoSnowliftViewableSphericalPhoto6=true;this.emit("onEnterFullScreen");v(this.$PhotoSnowliftViewableSphericalPhoto22());c("CSS").addClass(this.getElement(),"_tz-")};B.prototype.onExitFullScreen=function(){if(!this.$PhotoSnowliftViewableSphericalPhoto6)return;this.$PhotoSnowliftViewableSphericalPhoto6=false;this.emit("onExitFullScreen");x(this.$PhotoSnowliftViewableSphericalPhoto22());c("CSS").removeClass(this.getElement(),"_tz-")};B.prototype.$PhotoSnowliftViewableSphericalPhoto24=function(){return this.$PhotoSnowliftViewableSphericalPhoto7?this.$PhotoSnowliftViewableSphericalPhoto17:this.$PhotoSnowliftViewableSphericalPhoto14||this.$PhotoSnowliftViewableSphericalPhoto17};var C=function C(){__p&&__p();this.$PhotoSnowliftViewableSphericalPhoto29=function(D){__p&&__p();var E=D.dispatch,F=D.getState;if(this.$PhotoSnowliftViewableSphericalPhoto13.getTagger())E(t(this.$PhotoSnowliftViewableSphericalPhoto13.getTagger()));else this.$PhotoSnowliftViewableSphericalPhoto19.addSubscriptions(c("Arbiter").subscribe(this.$PhotoSnowliftViewableSphericalPhoto13.getEventString("TAGGER_READY"),function(G,H){E(t(this.$PhotoSnowliftViewableSphericalPhoto13.getTagger()))}.bind(this)));this.$PhotoSnowliftViewableSphericalPhoto19.addSubscriptions(c("Arbiter").subscribe("PhotoTagger.START_TAGGING",function(G,H){E(o())}),c("Arbiter").subscribe("PhotoTagger.STOP_TAGGING",function(G,H){E(p())}),c("Arbiter").subscribe("PhotoTags.SHOWTAG",function(G,H){c("Bootloader").loadModules(["SphericalMediaTaggingUtils"],function(I){var J=I.getSpatialTagFromFBID,K=J(H,F().base.tags);E(u(K))},"PhotoSnowliftViewableSphericalPhoto")}),c("Arbiter").subscribe("PhotoTags.HIDETAG",function(G,H){E(u(null))}),c("Arbiter").subscribe(this.$PhotoSnowliftViewableSphericalPhoto13.getEventString("EXTRA_DATA_CHANGE"),function(G,H){__p&&__p();var I,J=this,K=H?H.spatialTags:null;if(K&&Array.isArray(K))(function(){__p&&__p();E(s(K));E(q());var L=0;K.forEach(function(O){if(O.type!==m)L++});if(J.$PhotoSnowliftViewableSphericalPhoto11&&J.$PhotoSnowliftViewableSphericalPhoto11>L){var M=J.$PhotoSnowliftViewableSphericalPhoto11-L;for(var N=0;N<M;N++)E(n())}J.$PhotoSnowliftViewableSphericalPhoto11=L})()}.bind(this)));return function(G){return function(H){return G(H)}}}.bind(this);this.$PhotoSnowliftViewableSphericalPhoto28=function(D){__p&&__p();var E=D.getState;return function(F){return function(G){if(G.type===c("SphericalMediaActions").SHOW_FALLBACK){this.$PhotoSnowliftViewableSphericalPhoto9=true;c("CSS").hide(this.$PhotoSnowliftViewableSphericalPhoto3);var H=c("DOMQuery").scry(this.$PhotoSnowliftViewableSphericalPhoto13.stageWrapper,".fbPhotosPhotoActionsTag.tagButton");if(H.length>0)c("CSS").hide(H[0])}return F(G)}.bind(this)}.bind(this)}.bind(this);this.$PhotoSnowliftViewableSphericalPhoto26=function(){return function(D){return function(E){if(E.type===c("SphericalMediaActions").SETUP_RENDERER){this.$PhotoSnowliftViewableSphericalPhoto9=true;c("CSS").hide(this.$PhotoSnowliftViewableSphericalPhoto3);this.$PhotoSnowliftViewableSphericalPhoto13.adjustStageSize()}return D(E)}.bind(this)}.bind(this)}.bind(this);this.$PhotoSnowliftViewableSphericalPhoto27=function(D){__p&&__p();var E=D.getState,F=D.dispatch;return function(G){return function(H){if(H.type===c("SphericalMediaActions").TURN_ON||H.type===c("SphericalMediaActions").SHOW_FALLBACK){var I=function(){var J=this.$PhotoSnowliftViewableSphericalPhoto25();F(r(J.x,J.y))}.bind(this);this.$PhotoSnowliftViewableSphericalPhoto15.addSubscriptions(this.addListener("onEnterFullScreen",I),this.addListener("onExitFullScreen",I),this.addListener("onSetDimensions",I));I()}return G(H)}.bind(this)}.bind(this)}.bind(this)};f.exports=B}),null);
__d("PhotoSnowliftViewableUtils",["cx","DOM","EventProfiler","PhotoSnowliftViewableImageWrapper","PhotoSnowliftViewablePhoto","PhotoSnowliftViewableSphericalPhoto","React","ReactDOM","SphericalMediaGyroOverlay.react"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=65,j=0,k=0;function l(o,p){if(o.spherical)return new(c("PhotoSnowliftViewableSphericalPhoto"))(o.url,o.smallurl,o.spherical.cubestripuri,o.spherical.tiledsphericalconfig,o.spherical.initialviewverticalfov||i,o.spherical.initialpitch||j,o.spherical.initialheading||k,p.shouldShowHiRes(o),o.dimensions,o.spherical.partialLimits,String(o.info.fbid),p,o.spherical.photosphereMetadata,o.spherical.fallback);else return new(c("PhotoSnowliftViewablePhoto"))(o.url,o.smallurl,p.shouldShowHiRes(o),o.dimensions,String(o.info.fbid),!!o.info.disablecontextmenu,!!o.info.logcontextmenu,o.info.caption,o.info.shouldshowshield)}function m(){var o=c("DOM").create("div",{className:"_4yca _5nxw"});c("ReactDOM").render(c("React").createElement(c("SphericalMediaGyroOverlay.react"),{isActive:true}),o);return o}function n(o,p){var q=o.parentElement,r=new(c("PhotoSnowliftViewableImageWrapper"))(o);if(q)q.appendChild(r.getElement());if(p){c("EventProfiler").tagCurrentActiveInteractionsAs("PSVSphericalImage");r.getElement().appendChild(m())}return r}f.exports={fromStreamData:l,fromImageElement:n}}),null);
__d("PhotoViewer",["Bootloader","CSS","DOM"],(function a(b,c,d,e,f,g){__p&&__p();function h(){"use strict";this.image=null;this.root=null;this.stream=null}h.prototype.getEventString=function(i){"use strict";var j=this.getEventPrefix();if(j)return j+"."+i;return null};h.prototype.getImage=function(){"use strict";return this.image};h.prototype.getPosition=function(){"use strict";return this.stream?this.stream.getCursor():null};h.prototype.getRoot=function(){"use strict";return this.root};h.prototype.hiliteAllBoxes=function(){"use strict";c("DOM").scry(this.stageWrapper,"div.tagsWrapper div.faceBox").forEach(function(i){c("CSS").addClass(i,"otherActive")});c("DOM").scry(this.stageWrapper,"div.tagsWrapper div.fbPhotosPhotoTagboxBaseComments").forEach(function(i){c("CSS").addClass(i,"otherActive")})};h.prototype.getEventPrefix=function(){"use strict";return null};h.prototype.getSourceString=function(){"use strict";return null};h.prototype.getVersionConst=function(){"use strict";return null};h.prototype.getViewerSource=function(){"use strict";return null};h.prototype.getViewerSet=function(){"use strict";return null};h.bootstrap=function(i,j){"use strict";c("Bootloader").loadModules(["PhotoSnowlift"],function(k){k.bootstrap(i,j)},"PhotoViewer")};f.exports=h}),null);
__d("ReactComponentRenderer",["React","ReactDOM","warning"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i,j){this.klass=i;this.container=j;this.props={};this.component=null}h.prototype.replaceProps=function(i,j){this.props={};this.setProps(i,j)};h.prototype.setProps=function(i,j){if(this.klass==null)return;Object.assign(this.props,i);var k=c("React").createElement(this.klass,this.props),l=this;c("ReactDOM").render(k,this.container,function(){l.component=this;if(j)j.call(this)})};h.prototype.unmount=function(){c("ReactDOM").unmountComponentAtNode(this.container);this.klass=null};f.exports=h}),null);
__d("SnowliftVideoPivotsCarouselController",[],(function a(b,c,d,e,f,g){var h={setPivotsCarousel:function i(j,k){this._pivotsCarousel=j;this.adjustCarousel(k)},adjustCarousel:function i(j){if(this._pivotsCarousel)this._pivotsCarousel.pageTo(j)},adjustCarouselOnAutoPlay:function i(){if(this._pivotsCarousel)this._pivotsCarousel.page()}};f.exports=h}),null);
__d("PhotoSnowlift",["csx","cx","fbt","invariant","Arbiter","AsyncRequest","Bootloader","CSS","CurrentUser","DataAttributeUtils","DataStore","Dialog","DisableContextMenuMixin","DOM","DOMControl","DOMQuery","EncryptedImg","Event","FullScreen","FunnelLogger","ImageUtils","Input","JSReliabilityFixesGatingConfig","Keys","Layer","LikeConfirmer","LinkController","LitestandShareAttachment","LitestandStoryInsertionStatus","Locale","ObjectionableContentFilterMixin","PageTransitions","Parent","PhotoLogger","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotosetPivotSlide.react","PhotosetSearchPivot.react","PhotosetSearchPivotData","PhotoSnowliftActionsGating","PhotoSnowliftAds","PhotoSnowliftBackLink.react","PhotoSnowliftLoader","PhotoSnowliftLoggingConfig","PhotoSnowliftViewableUtils","PhotoStreamCache","PhotosUtils","PhotoTagSearchPivotLogger","PhotoViewer","React","ReactComponentRenderer","ReactDOM","Rect","ScriptPath","ScrollableArea","SnowliftDestroyVideoPlayerExperiment","SnowliftUFIContextualParentExperiment","SnowliftVideoPivotsCarouselController","Style","SubscriptionsHandler","TimeSlice","Toggler","Tooltip","TrackingNodes","TrackingNodeTypes","UFIFeedbackTargets","UFIRootRegistry","UFIUIEvents","UIPagelet","URI","UserAgent_DEPRECATED","Vector","VideoData","VideoPermalinkURI","VideoPlayerAbortLoadingExperiment","VideoPlayerReason","WebSpeedJSExperiments","$","classWithMixins","computeRelativeURI","emptyFunction","ge","getActiveElement","goURI","isNode","mixin","setImmediate","setTimeoutAcrossTransitions","tickerPhoteSnowLiftOpenStatus"],(function a(b,c,d,e,f,g,h,i,j,k){"use strict";__p&&__p();var l,m,n=c("JSReliabilityFixesGatingConfig").should_get_fix,o="WWW_SNOWLIFT_ACTIONS_FUNNEL",p=74,q=75,r=70,s=76,t=315,u=200,v=2e3,w=new RegExp("\\/posts\\/(\\d+)\\/?$");l=babelHelpers.inherits(x,c("classWithMixins")(c("PhotoViewer"),c("mixin")(c("ObjectionableContentFilterMixin"),c("DisableContextMenuMixin"))));m=l&&l.prototype;function x(){__p&&__p();m.constructor.call(this);this.switchTimer=null;this.imageRefreshTimer=null;this.imageLoadingTimer=null;this.lastPage=0;this.currentMinSize=null;this.currentImageSize=null;this.resetUriStack=true;this.thumbSpherical=false;this.thumbSrc=null;this.shouldStretch=false;this.stageMax=x.STAGE_NORMAL_MAX;this.stageChrome=x.STAGE_CHROME;this.stagePagerPrev=null;this.ua=null;this.PhotoTagger=null;this._inputBarAdjusted=false;this._seenTags={};this._navCount=0;this._navHistory=[];this._preloadTimeout=0;this.clearAlbumBoundaries()}x.prototype.preload=function(y,z){c("Bootloader").loadModules(["PhotoTagger","Live","PhotoTagApproval","PhotoTags","TagTokenizer","css:fb-photos-snowlift-fullscreen-css"],function(A){this.PhotoTagger=A}.bind(this),"PhotoSnowlift")};x.prototype.bootstrap=function(y,z){__p&&__p();this.preload(y,z);this._href=y;this._elem=z;if(this.closeDirty){setTimeout(this.bootstrap.bind(this,y,z),0);return}c("PhotoSnowliftAds").reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false}else return;this._dataFt=null;var A=null;if(z)A=c("Parent").bySelector(z,"._4oep");if(A===null){var B=c("Parent").byAttribute(z,"data-cursor");if(B)try{var C=JSON.parse(c("DataAttributeUtils").getDataFt(B));this._dataFt={qid:C.qid,mf_story_key:C.mf_story_key,top_level_post_id:C.top_level_post_id,page_insights:C.page_insights}}catch(D){}else try{B=c("Parent").byAttribute(z,"data-ad");B=c("DataAttributeUtils").getParentByAttributeOrDataStoreKey(z,"data-ad","data-ad");var E=JSON.parse(c("DataAttributeUtils").getDataAttribute(B,"data-ad"));this._dataFt={ad_id:E.adid}}catch(D){}}this.returningToStart=false;this.loading&&c("CSS").removeClass(this.loading,"loading");if(z){c("CSS").addClass(this.loading=z,"loading");var F=void 0;if(c("SnowliftUFIContextualParentExperiment").useUfiContextualParent)F=A||c("Parent").byClass(z,"uiStreamStory")||c("Parent").bySelector(z,"._5jmm");else F=c("Parent").byClass(z,"uiStreamStory")||A||c("Parent").bySelector(z,"._5jmm");if(F)this.storyID=F.id;else{var G=c("Parent").bySelector(z,"._5b9c");if(G)this.storyID=G.getAttribute("data-ownerid")}this._updateContainerOwnerID();this.getThumbAndSize(z)}else this.loading=null;c("Arbiter").inform("PhotoSnowlift.GO",y,c("Arbiter").BEHAVIOR_STATE);this.loadFrameIfUninitialized()};x.prototype._updateContainerOwnerID=function(){if(this.container)if(this.storyID)this.container.setAttribute("data-ownerid",this.storyID);else this.container.removeAttribute("data-ownerid")};x.prototype.getEventPrefix=function(){return"PhotoSnowlift"};x.prototype.getRoot=function(){return this.root};x.prototype.getSourceString=function(){return"snowlift"};x.prototype.getViewerSource=function(){return this.source};x.prototype.getViewerSet=function(){return this.stream.getPhotoSet()};x.prototype.getVersionConst=function(){return c("PhotosConst").VIEWER_SNOWLIFT};x.prototype.getImage=function(){return this._viewable.getElement()};x.prototype.getImageId=function(){return this.stream.getCursor()};x.prototype.getRHCHeader=function(){return this.rhcHeader};x.prototype.getRHCBody=function(){return this.ufiForm};x.prototype.getRHCFooter=function(){return this.rhcFooter};x.prototype.getLoadQuery=function(){return this.loadQuery};x.prototype.getCurrentPhotoInfo=function(){var y=this.stream.getCurrentImageData();if(y)return y.info;return null};x.prototype.getOwnerId=function(){var y=this.stream.getCurrentImageData();if(y)return y.info.owner;return null};x.prototype.getThumbAndSize=function(y){__p&&__p();this.currentImageSize=null;this.thumbSpherical=false;this.thumbSrc=null;var z=new(c("URI"))(y.getAttribute("ajaxify")).getQueryData();if(!z.size)return;var A=c("Vector").deserialize(z.size);if(!A.x||!A.y)return;this.currentImageSize=A;if(y.getAttribute("data-cropped"))return;var B=c("DOM").scry(y,"img")[0],C=c("DOM").scry(y,"i")[0],D=c("Parent").byAttribute(y,"data-size");this.shouldStretch=D&&this.currentImageSize&&B&&D.getAttribute("data-size")==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=x.TIMELINE_STRETCH_WIDTH&&B.offsetWidth===x.TIMELINE_STRETCH_WIDTH;var E;if(B){E=B.src;this.thumbSpherical=Boolean(B.getAttribute("data-is-spherical-photo"))}else if(C)E=c("Style").get(C,"backgroundImage").replace(/.*url\(\"?([^\"]*)\"?\).*/,"$1");else return;this.thumbSrc=E};x.prototype.loadFrameIfUninitialized=function(){if(this.root)return;var y=String(c("URI").getMostRecentURI().getQueryData().viewas);c("PhotoSnowliftLoader").loadFrame(y)};x.prototype.init=function(y,z){__p&&__p();this.init=c("emptyFunction");this._shouldLog=z.photos_client_loading;this._logger=null;if(this._shouldLog)this._logger=new(c("PhotoLogger"))(c("PhotosConst").VIEWER_SNOWLIFT_STRING);this._showHover=z.pivot_hover;this._showMorePhotos=z.show_more_photos;this._extraSlidePivot=z.extra_slide_pivot;this._uiRefresh=z.snowlift_ui_refresh;c("PhotoSessionLog").setEndMetrics(z.pivot_end_metric);this.startingMousePos=null;this.haveLeftBufferRegion=false;this.showingTypeaheadSuggestions=false;this.fullscreen=c("FullScreen").isSupportedWithKeyboardInput();this.showOGVideos=z.og_videos;this.resizeCommentsForAds=z.resize_comments_for_ads;this.spotlight=y;this.spotlight.subscribe("blur",function(){this.closingAction=c("PhotoSessionLog").OUTSIDE}.bind(this));this.spotlight.subscribe("hide",this.closeHandler.bind(this));this.spotlight.subscribe("key",this.keyHandler.bind(this));this._actionMenuOpen=false;this._mouseOnPhotoStage=false;this.initializeNodes(this.spotlight.getRoot());this.disableContextMenu();c("PhotoSnowliftAds").init(this.sideAdUnit,this,z,this.adsDisplayedCallback.bind(this));this.inAdsDisplayedCallback=false;this.lastAdsHeight=0;if(!this.subscription){c("LinkController").registerHandler(this.handleNavigateAway.bind(this));this.subscription=c("Arbiter").subscribe("PhotoSnowlift.GO",function(A,B){this.openExplicitly=true;this.loading&&c("CSS").removeClass(this.loading,"loading");this.open(B)}.bind(this))}this.transitionHandlerRegistered=false;this.returningToStart=false;c("PageTransitions").registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;c("Arbiter").subscribe("PhotoTagApproval.HILITE_TAG",this.onHiliteTag.bind(this));c("Arbiter").subscribe("PhotoTagApproval.UPDATE_TAG_BOX",this.onUpdateTagBox.bind(this));if(this.fullscreen)c("FullScreen").subscribe("changed",this.onFullScreenChange.bind(this));this.buttonTruncateGk=z.snowlift_button_truncate;this.allowIrrelevantRequests=!!z.snowlift_allow_irrelevant_requests;if(this.snowflake){c("CSS").addClass(this.root,"snowflake");this.extraClasses.forEach(function(A){c("CSS").addClass(this.root,A)},this)}};x.prototype.onFullScreenChange=function(){__p&&__p();if(!this.isOpen)return;var y=c("FullScreen").isFullScreen();c("CSS").conditionClass(document.body,"fbPhotoSnowliftFullScreenMode",y);if(y){this.lastFullscreenEnter=Date.now();if(!c("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode"))this.collapseRHC();this._viewable.onEnterFullScreen();this.adjustForResize()}else{this.uncollapseRHC();this._viewable.onExitFullScreen();if(c("UserAgent_DEPRECATED").chrome()&&this.lastPage>this.lastFullscreenEnter&&!c("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode"))this.page(0,false);c("Arbiter").inform("reflow")}c("Toggler").hide()};x.prototype.initializeNodes=function(y){__p&&__p();this.root=y;this.container=c("DOM").find(y,"div.fbPhotoSnowliftContainer");this._updateContainerOwnerID();this.snowliftPopup=c("DOM").find(this.container,"div.fbPhotoSnowliftPopup");this.rhc=c("DOM").find(this.snowliftPopup,"div.rhc");this.rhcHeader=c("DOM").find(this.rhc,"div.rhcHeader");this.rhcFooter=c("DOM").find(this.rhc,"div.rhcFooter");this.taglist=c("DOM").find(this.rhc,"span.fbPhotoTagList");this.ufiForm=c("DOM").find(this.rhc,"form.fbPhotosSnowliftFeedbackForm");this.ufiInputContainer=c("DOM").find(this.rhc,"div.fbPhotosSnowboxFeedbackInput");this.scroller=c("DOM").find(this.ufiForm,"div.rhcScroller");this.scrollerBody=c("DOM").find(this.scroller,"div.uiScrollableAreaBody");this.stageWrapper=c("DOM").find(this.snowliftPopup,"div.stageWrapper");this.overlay=c("DOM").find(this.snowliftPopup,"div.snowliftOverlay");this.errorBox=c("DOM").find(this.stageWrapper,"div.stageError");this._viewable=c("PhotoSnowliftViewableUtils").fromImageElement(c("DOM").find(this.stageWrapper,"img.spotlight"));this.stage=c("DOM").find(this.stageWrapper,"div.stage");this.videoStage=c("DOM").find(this.stageWrapper,"div.videoStage");this.prevPager=c("DOM").find(this.snowliftPopup,"a.snowliftPager.prev");this.nextPager=c("DOM").find(this.snowliftPopup,"a.snowliftPager.next");this.stageActions=c("DOM").find(y,"div.stageActions");if(!this._uiRefresh)this.buttonActions=c("DOM").find(this.stageActions,"div.fbPhotosPhotoButtons");this.placeInfo=c("DOM").find(this.rhc,"div.fbPhotosSnowliftPlaceInfo");this.seeMore=c("DOM").find(this.rhc,"._jke");this.sideAdUnit=c("DOM").find(y,"._5ciw");c("CSS").conditionClass(this.root,"fullScreenAvailable",this.fullscreen)};x.prototype.getContextMenuContainer=function(){return this.stageWrapper};x.prototype.getObjectionableWarningContainer=function(){return this.stageWrapper};x.prototype.getObjectionableWarningHiddenContent=function(){return this.isVideo()?this.videoStage:this.stage};x.prototype.isVideo=function(){var y=this.stream.getCurrentImageData();if(y&&y.info.video)return true;return false};x.prototype.initializeScroller=function(){__p&&__p();this.initializeScroller=c("emptyFunction");c("CSS").addClass(this.scroller,"_467y");this.scrollableArea=c("ScrollableArea").fromNative(this.scroller,{fade:true,persistent:true});var y=function(event){__p&&__p();var z=c("Event").$E(event).getTarget();if(c("DOM").contains(this.ufiInputContainer,z)){var A=c("DOMControl").getInstance(z);if(A){this.scrollableArea.scrollToBottom();var B=A.subscribe("resize",function(){var D=this.scrollableArea.isScrolledToBottom();this.adjustScroller();D&&this.scrollableArea.scrollToBottom()}.bind(this)),C=c("Event").listen(z,"blur",function(){A.unsubscribe(B);C.remove()})}}if(z.classList.contains("UFIPagerLink")||z.classList.contains("UFICommentLink"))if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.haltAutoplay=true}.bind(this);c("Arbiter").subscribe(c("UFIUIEvents").InputHeightChanged,function(z,A){if(c("DOM").contains(this.ufiInputContainer,A.node))this.adjustScroller()}.bind(this));c("Arbiter").subscribe(c("UFIUIEvents").PhotoPreviewHeightChanged,function(z,A){if(!A.node||c("DOM").contains(this.ufiInputContainer,A.node))this.adjustScroller()}.bind(this));c("Arbiter").subscribe(c("UFIUIEvents").Changed,function(z,A){if(this.ufiForm===A.form)this.adjustScrollerIfNecessary()}.bind(this));c("Arbiter").subscribe(c("UFIUIEvents").Comment,function(z,A){if(this.ufiForm===A.form){this.adjustScrollerIfNecessary();if(A.isinverted)this.scrollableArea.scrollToTop();else this.scrollableArea.scrollToBottom()}}.bind(this));c("Event").listen(this.rhc,"click",function(event){var z=event.getTarget();if(c("Parent").byTag(z,"a")||c("Parent").byTag(z,"button")||c("DOM").isNodeOfType(z,"input"))this.adjustScrollerIfNecessary()}.bind(this));c("Arbiter").subscribe(["reflow",c("UFIUIEvents").CommentPager],function(){if(this.isOpen)this.adjustScrollerIfNecessary()}.bind(this));c("Arbiter").subscribe(c("UFIUIEvents").TranslationRendered,function(){this.adjustScrollerIfNecessary()}.bind(this));c("Event").listen(this.ufiForm,"focusin",y)};x.prototype.openHandler=function(y){if(this.isOpen||!c("PhotoPermalinkURI").isValid(y)||this.returningToStart||y.getQueryData().closeTheater||y.getQueryData().permPage){this.openHandlerRegistered=false;return false}this.open(y);this._uriStack.push(new(c("URI"))(y).getQualifiedURI().toString());c("PageTransitions").transitionComplete(true);return true};x.prototype.addHaltAutoplaySubscription=function(){c("Arbiter").subscribe([c("UFIUIEvents").Focus],function(){this.haltAutoplay=true}.bind(this));c("Arbiter").subscribe([c("UFIUIEvents").Blur],function(y,z){this.haltAutoplay=z.hasEnteredText}.bind(this))};x.prototype.open=function(y){__p&&__p();var z=new(c("URI"))(y),A=z.getQueryData(),B=Object.create(null),C=c("PhotoPermalinkURI").parse(z);if(C!=null){A.fbid=C.photo_id;A.set=C.set_token;B.snowlift_content_id=C.photo_id}var D=c("VideoPermalinkURI").parse(z);if(D!=null){A.v=D.video_id;A.set=D.set_token;B.snowlift_content_id=D.video_id}if(this._elem!=null){A.external_log_id=this._elem.getAttribute("data-external-log-id");A.player_origin=this._elem.getAttribute("data-player-origin")}c("ScriptPath").openOverlayView("snowlift",B);if(!A.fbid&&!A.v&&!A.pid){var E=w.exec(z.getPath());if(E)A.v=E[1]}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){A.firstLoad=true;this.initialLoad=true;c("LitestandStoryInsertionStatus").registerBlocker(function(){return this.isOpen}.bind(this));c("tickerPhoteSnowLiftOpenStatus").registerOpenChecker(function(){return this.isOpen}.bind(this))}this.sessionID=Date.now();this.loadQuery=Object.assign(A,{ssid:this.sessionID});if(this._dataFt)this.loadQuery.data_ft=this._dataFt;this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.movementDelta=0;this.pivotsCarouselElement=null;this.autoplayOptionScreenConfig=null;this.haltAutoplay=false;this.shouldRenderVideoPivots=false;c("CSS").show(this.nextPager);c("CSS").show(this.prevPager);this.source=null;this.saveTagSubscription=c("Arbiter").subscribe("PhotoTagger.SAVE_TAG",this.onTagSaved.bind(this));this.taggedPhotoIds=[];this.stream=new(c("PhotoStreamCache"))();this.stream.init(c("PhotosConst").VIEWER_SNOWLIFT,"PhotoViewerPagelet","pagelet_photo_viewer",this._shouldLog?this._logger:null,A.tagSuggestionMode||"everyone");if(c("URI").getMostRecentURI().getQueryData().viewas)this.stream.setViewAs(c("URI").getMostRecentURI().getQueryData().viewas+"");if(c("URI").getMostRecentURI().getQueryData().ifg)this.stream.setIsFromGroups(c("URI").getMostRecentURI().getQueryData().ifg);this.fetchInitialData();this.setLoadingState(x.STATE_HTML,true);this.rhcCollapsed=false;this._open(y);c("Bootloader").loadModules(["PhotosButtonTooltips"],function(F){F.init()},"PhotoSnowlift");this._navHistory.push(z.getQualifiedURI().toString())};x.prototype._open=function(y){__p&&__p();this.createLoader();this.spotlight.show();c("Arbiter").inform("layer_shown",{type:"PhotoSnowlift"});c("Arbiter").inform("PhotoSnowlift.OPEN");this.stageHandlers=[c("Event").listen(window,"resize",this.adjustForResize.bind(this)),c("Event").listen(this.stageWrapper,"click",function(event){__p&&__p();var B=c("DataAttributeUtils").getClickTrackingParent(event.getTarget());if(!B)return;try{var C=JSON.parse(c("DataAttributeUtils").getDataFt(B));if(!C.tn)return;var D=c("TrackingNodes").parseTrackingNodeString(C.tn),E=Object.keys(c("TrackingNodeTypes")).filter(function(G){return c("TrackingNodeTypes")[G]===D});if(E.length)c("FunnelLogger").appendAction(o,"click_"+E.join("_"))}catch(F){}}),c("Event").listen(this.stageWrapper,"click",this.buttonListener.bind(this)),c("Event").listen(this.stageWrapper,"mouseleave",function(event){var B=event.getTarget();if(c("Parent").bySelector(B,"._khz"))return;if(!(c("Parent").byClass(B,"snowliftOverlay")||c("Parent").byClass(B,"fbPhotoSnowliftTagApproval")||c("Parent").byClass(B,"tagPointer")||c("Parent").byClass(B,"arrow")||c("Parent").byClass(B,"faceboxSuggestion")||c("Parent").byClass(B,"typeaheadWrapper")||c("Parent").byClass(B,"photoTagTypeahead")||c("Parent").byClass(B,"fbPhotoTagger")))this.unhiliteAllTags();this._mouseOnPhotoStage=false;this.hidePagers()}.bind(this)),c("Event").listen(this.stageWrapper,"mousemove",this.hilitePager.bind(this)),c("Event").listen(this.stageWrapper,"mousemove",this.hiliteTagsOnMouseMove.bind(this)),c("Event").listen(this.stageWrapper,"mouseenter",function(){return this._mouseOnPhotoStage=true}.bind(this)),c("Event").listen(this.overlay,"mouseenter",this.unhiliteAllTags.bind(this)),c("Event").listen(this.container,"mousemove",this._enableMouseOver.bind(this)),c("Event").listen(this.container,"mouseover",this._interceptMouseOver.bind(this)),c("Event").listen(this.stageWrapper,"focusin",this.hilitePager.bind(this)),c("Event").listen(this.rhc,"focusin",this.hidePagers.bind(this))];this.stageHandlers.push(c("Event").listen(this.root,"click",function(event){__p&&__p();var B=event.getTarget();if(c("Parent").bySelector(B,"._418x")){if(c("FullScreen").isFullScreen()){c("FunnelLogger").appendActionWithTagIfNew(o,"fullscreen_exit","fbPhotoSnowlift/close");c("FullScreen").toggleFullScreen();return}this.closingAction=c("PhotoSessionLog").X;this.spotlight.hide()}else if(this._isLiveBroadcast&&c("Parent").bySelector(B,"._3ixn"))this.spotlight.hide()}.bind(this)),c("Event").listen(this.container,"click",function(event){__p&&__p();var B=event.getTarget();if(c("Parent").byClass(B,"rotateRight")){c("FunnelLogger").appendActionWithTag(o,"rotate_image","right");this.rotate("right")}else if(c("Parent").byClass(B,"rotateLeft")){c("FunnelLogger").appendActionWithTag(o,"rotate_image","left");this.rotate("left")}else if(c("Parent").bySelector(B,"._32_l")){c("FunnelLogger").appendAction(o,"click-pivot-item");var C=c("Parent").bySelector(B,"._32_l"),D=C.getAttribute("data-fbid"),E=this.stream.getCursor(),F=this.stream.calculateDistance(E,D),G=this.stream.fbidList.indexOf(D);c("SnowliftVideoPivotsCarouselController").adjustCarousel(G);this.page(F,false);this.haltAutoplay=false;this.removeAutoplayOptionScreen()}else if(c("Parent").byClass(B,"fbPhotoSnowliftZoom"))this.openZoom(event);else if(this.fullscreen)if(c("Parent").byClass(B,"fbPhotoSnowliftFullScreen")){c("FunnelLogger").appendActionWithTagIfNew(o,c("FullScreen").isFullScreen()?"fullscreen_exit":"fullscreen_enter","fbPhotoSnowliftFullScreen");this.toggleFullScreen()}else if(c("Parent").byClass(B,"fbPhotoSnowliftCollapse")){this.toggleCollapse();c("FunnelLogger").appendAction(o,"toggle_collapse-rhc")}else if(c("FullScreen").isFullScreen()&&c("Parent").bySelector(B,".overlayBarButtons .comment_link")){this.toggleCollapse();c("FunnelLogger").appendAction(o,"toggle_collapse-rhc")}var H=c("Parent").byAttribute(B,"data-action-type");if(H){var I=H.getAttribute("data-action-type"),J=H.getAttribute("data-action-tag");c("FunnelLogger").appendActionWithTag(o,I,J)}else if(c("Parent").byClass(B,"addLocation")){var K=c("Parent").byClass(B,"addLocation");c("FunnelLogger").appendActionWithTag(o,"add_location",c("CSS").hasClass(K,"photosTruncatingUIButton")?null:"from-action-bar")}else if(c("Parent").byClass(B,"fbPhotosPhotoActionsTag")){var L=c("Parent").byClass(B,"fbPhotosPhotoActionsTag");if(c("CSS").hasClass(L,"tagButton"))c("FunnelLogger").appendActionWithTag(o,"tag_photo","start-tagging");else if(c("CSS").hasClass(L,"doneTaggingLink"))c("FunnelLogger").appendActionWithTag(o,"tag_photo","end-tagging");else if(c("CSS").hasClass(L,"taggingOff"))c("FunnelLogger").appendActionWithTag(o,"tag_photo","tagging-off");else if(c("CSS").hasClass(L,"taggingOn"))c("FunnelLogger").appendActionWithTag(o,"tag_photo","tagging-on")}else if(c("Parent").byClass(B,"UFILikeLink"))c("FunnelLogger").appendAction(o,"like-photo")}.bind(this)));var z=c("ge")("fbPhotoSnowliftFeedback");if(z)this.stageHandlers.push(c("Event").listen(z,"click",function(event){var B=event.getTarget();if(c("Parent").byClass(B,"like_link")||c("Parent").byClass(B,"UFILikeLink")&&c("Parent").byClass(B,"UIActionLinks"))this.toggleLikeButton();var C=c("Parent").byClass(event.getTarget(),"uiUfiCollapsedComment");if(C){c("FunnelLogger").appendActionWithTag(o,"like-photo","snowlift-feedback");c("CSS").addClass(C,"uiUfiCollapsedCommentToggle")}}.bind(this)));var A=c("ge")("fbPhotoSnowliftOnProfile");if(A)this.stageHandlers.push(c("Event").listen(A,"click",function(event){if(c("Parent").byClass(event.getTarget(),"fbPhotoRemoveFromProfileLink"))this.refreshOnClose=true}.bind(this)));if(this.resetUriStack)this.startingURI=c("URI").getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();this.setLoadingState(x.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){c("PageTransitions").registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true}c("PhotoSessionLog").initLogging(c("PhotoSessionLog").SNOWLIFT);if(this._dataFt)c("PhotoSessionLog").setTopLevelPostId(this._dataFt.top_level_post_id);if(this.pivots)c("PhotoSessionLog").setRelevantCount(this.pivots.relevantCount)};x.prototype.toggleFullScreen=function(){var y=c("FullScreen").toggleFullScreen(document.documentElement);if(y){this._viewable.onToggleIntoFullScreen();c("PhotoSessionLog").logEnterFullScreen(this.stream.getCursor())}else this._viewable.onToggleOutOfFullScreen()};x.prototype._getIsZoomAllowed=function(y){return!!(y&&!y.video&&!y.spherical&&y.dimensions&&(y.dimensions.x>window.innerWidth||y.dimensions.y>window.innerHeight))};x.prototype.showZoom=function(y){c("CSS").conditionClass(this.root,"zoomAvailable",this._getIsZoomAllowed(y))};x.prototype.openZoom=function(event){__p&&__p();var y=this.stream.getCurrentImageData();this._viewable.onToggleIntoFullScreen();var z=c("DOM").find(this.stageWrapper,"._2-sx"),A=z.getBoundingClientRect();z.style.width="auto";z.style.height="auto";z.classList.add("zoom");var B=void 0,C=void 0;if(y){var D=y.dimensions;B=Math.max(0,D.x-window.innerWidth);C=Math.max(0,D.y-window.innerHeight)}else{var E=z.getBoundingClientRect();B=Math.max(0,E.width-window.innerWidth);C=Math.max(0,E.height-window.innerHeight)}var F=false;if(B){F=true;B+=u*2;z.classList.add("overflowX")}if(C){F=true;C+=u*2;z.classList.add("overflowY")}var G=void 0;if(F){var H=-event.clientX/window.innerWidth*B+"px",I=-event.clientY/window.innerHeight*C+"px";z.style.transform="translate3d("+H+","+I+",0)";G=c("Event").listen(z,"mousemove",function(event){var H=-event.clientX/window.innerWidth*B+"px",I=-event.clientY/window.innerHeight*C+"px";z.style.transform="translate3d("+H+","+I+",0)"})}var J=null,K=null,L=function L(){__p&&__p();z.style.width=A.width+"px";z.style.height=A.height+"px";z.style.transform="";z.classList.remove("zoom","overflowX","overflowY");if(G)G.remove();J.remove();M.unsubscribe(K);M.destroy();return false},M=new(c("Layer"))({},document.createElement("div"));K=M.subscribe("key",L);M.show();J=c("Event").listen(z,"click",L);this._viewable.onEnterFullScreen()};x.prototype.getStream=function(){return this.stream};x.prototype.fetchInitialData=function(){this.stream.waitForInitData();var y=this.loadQuery.within_business?this.loadQuery.business_thread_id:this.loadQuery.fbid,z=c("UFIFeedbackTargets").getFeedbackTargetIfExists(y)||{};c("UIPagelet").loadFromEndpoint("PhotoViewerInitPagelet",c("ge")("pagelet_photo_viewer_init",this.root),this.loadQuery,{actorID:z.actorforpost||null,usePipe:true,jsNonblock:true,crossPage:true,allowIrrelevantRequests:this.allowIrrelevantRequests});this.adjustScroller();this.disableAds=!c("CurrentUser").isLoggedIn()||this.loadQuery.eid||this.loadQuery.within_business||this.loadQuery.viewas;this.loadAds()};x.prototype.toggleCollapse=function(){if(this.rhcCollapsed)this.uncollapseRHC();else this.collapseRHC()};x.prototype.collapseRHC=function(){this.rhcCollapsed=true;c("CSS").addClass(this.root,"collapseRHC");this.adjustForResize()};x.prototype.uncollapseRHC=function(){this.rhcCollapsed=false;c("CSS").removeClass(this.root,"collapseRHC");this.adjustForResize()};x.prototype.closeHandler=function(){if(!this.isOpen)return;this.closingAction=this.closingAction||c("PhotoSessionLog").ESC;if(c("URI").getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return}this.returnToStartingURI(this.refreshOnClose);this.close()};x.prototype.returnToStartingURI=function(y,z){__p&&__p();if(!y)if(z)this.squashNextTransition(c("goURI").bind(null,z));else this.squashNextTransition();this.returningToStart=true;var A=c("Arbiter").subscribe("page_transition",function(){this.returningToStart=false;A.unsubscribe()}.bind(this)),B=y||isNaN(c("UserAgent_DEPRECATED").opera()),C=this._uriStack.length;if(B&&C<window.history.length)window.history.go(-C);else{var D=this.startingURI,E=new(c("URI"))(D).removeQueryData("closeTheater");if(D.getQueryData().sk=="approve"&&D.getPath()=="/profile.php"){E.removeQueryData("highlight");E.removeQueryData("notif_t")}c("goURI")(E)}};x.prototype.squashNextTransition=function(y){__p&&__p();this.squashNext=true;c("PageTransitions").registerHandler(function z(){if(this.squashNext){this.squashNext=false;if(y)setTimeout(y,0);c("PageTransitions").transitionComplete(true);return true}return false}.bind(this),7)};x.prototype.handleNavigateAway=function(y){__p&&__p();var z=c("computeRelativeURI")(c("PageTransitions").getMostRecentURI().getQualifiedURI(),y.getAttribute("href"));if(this.backButton&&c("ReactDOM").findDOMNode(this.backButton)===y){this._navHistory.pop();this.resetUriStack=false;this.open(z.toString());this._navHistory.pop();this.currentAuthorName=null;return false}if(c("Parent").bySelector(y,"._56lp a")){this.resetUriStack=false;this.open(z.toString());return false}if(this.isOpen&&z instanceof c("URI")&&z.getUnqualifiedURI().toString()!=this.startingURI.toString()&&z.getPath()!="/photo.php"){if(!this.closingAction)this.closingAction=c("PhotoSessionLog").NAVIGATE;this.returnToStartingURI(false,z);this.close();return false}if((z instanceof c("URI")||!n)&&z.getPath()=="/photo.php"&&c("URI").getMostRecentURI().getPath()!=="/photo.php")this.close();return true};x.prototype.postProcessTaggedPhotos=function(){if(this.taggedPhotoIds&&this.taggedPhotoIds.length>0){var y=null;if(this.source===x.COLLECTIONS_UNTAGGED_PHOTOS)y="/ajax/photos/photo/edit/skiptag/";else if(this.source===x.PHOTOS_OF_YOU_SUGGESTIONS||this.source===x.FRIENDS_IN_PHOTOS_SUGGESTIONS)y="/ajax/photos/photo/add_to_star_grid/";if(y)new(c("AsyncRequest"))().setURI(y).setAllowCrossPageTransition(true).setData({media_id:this.taggedPhotoIds,source:this.source}).send()}};x.prototype.onTagSaved=function(y,z){if(this.taggedPhotoIds){if(this.source===x.PHOTOS_OF_YOU_SUGGESTIONS&&!z.self_tag)return;this.taggedPhotoIds.push(z.photo_fbid)}};x.prototype.clearAlbumBoundaries=function(){this._albumBoundaries={start:0,end:0,dir:0}};x.prototype.close=function(){__p&&__p();if(!this.isOpen)return;c("FunnelLogger").appendActionWithTag(o,"close_snowlift",c("PhotoSessionLog").closingTypeToString(this.closingAction));c("FunnelLogger").endFunnel(o);this._albumFBID=null;this.hideMorePhotos();this.hidePivotSlide();this._pauseVideoIfNeeded();this._destroyVideoIfNeeded();this.isOpen=false;this._navCount=0;this.clearAlbumBoundaries();if(this.fullscreen)c("FullScreen").disableFullScreen();c("CSS").removeClass(document.body,"fbPhotoSnowliftFullScreenMode");this.spotlight.hide();this.openExplicitly=false;this.postProcessTaggedPhotos();c("Arbiter").unsubscribe(this.saveTagSubscription);this.taggedPhotoIds=[];this.closeDirty=true;c("setTimeoutAcrossTransitions")(this.closeCleanup.bind(this),0);if(this.snowflake){c("CSS").removeClass(this.root,"snowflake");this.extraClasses.forEach(function(y){c("CSS").removeClass(this.root,y)},this)}c("UFIRootRegistry").cleanupSnowliftNodes();this.extraClasses=[];this.snowflake=false;this.firstInSet=null;this.movementDelta=0};x.prototype.closeCleanup=function(){__p&&__p();c("ScriptPath").closeOverlayView("snowlift");this.closeDirty=false;c("CSS").removeClass(this.root,"dataLoading");c("PhotoSessionLog").logPhotoViews(this.closingAction);this.destroy();c("CSS").hide(this.errorBox);this._viewable.hide();this.thumbSpherical=false;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;var y=this.stream.getCursor();if(c("VideoPlayerAbortLoadingExperiment").canAbort){var z;for(z=0;z<this.stream.getLength();z++){var A=this.stream.getImageData(this.stream.getCursorAt(z));if(A&&A.video&&A.controller)A.controller.abortLoading()}}c("CSS").removeClass(this.stageWrapper,"showVideo");this._emptyVideoStage();if(this.PhotoSnowliftVideoNode)this.PhotoSnowliftVideoNode.destroyVideoNode();this.uncollapseRHC();this.currentImageSize=null;this.currentMinSize=null;this.setStagePagersState("reset");this.recacheData();c("DOM").empty(this.sideAdUnit);this.stream.destroy();this.root.setAttribute("aria-busy","true");this._navHistory=[];var B=this.closingAction===c("PhotoSessionLog").NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){c("PageTransitions").registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true}c("Arbiter").inform("layer_hidden",{type:"PhotoSnowlift"});c("Arbiter").inform("PhotoSnowlift.CLOSE",{is_navigating:B,fbid:y})};x.prototype.createLoader=function(y){__p&&__p();if(this.currentImageSize===null)this.adjustStageSize(x.STAGE_MIN);else{var z=this.getStageSize(this.currentImageSize);z=new(c("Vector"))(Math.max(z.x,this.getMinimumStageWidth()),Math.max(z.y,x.STAGE_MIN.y));var A=this.getImageSizeInStage(this.currentImageSize,z);if(c("WebSpeedJSExperiments").minimum_snowlift&&this._elem&&this._elem.getAttribute("data-ploi"))this.thumbSrc=c("PhotoSnowliftLoader").getImageURL(this._elem);if(this.thumbSrc===null)this.adjustStageSize(A);else{var B=c("TimeSlice").getGuardedContinuation("Snowlift thumb image load"),C=c("DOM").create("img",{className:"spotlight",alt:"",src:this.thumbSrc,style:{width:A.x+"px",height:A.y+"px"},onload:B.bind(undefined,c("emptyFunction"))});this._useViewable(c("PhotoSnowliftViewableUtils").fromImageElement(C,this.thumbSpherical),A,false)}}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(y)setTimeout(function(){__p&&__p();var D=function(){var I=arguments.length<=0||arguments[0]===undefined?null:arguments[0];if(!this.isOpen)return;if(!this.stream||!this.stream.errorInCurrent()){this._switchViewable(I?I:y,this.currentImageSize);this.setLoadingState(x.STATE_IMAGE_DATA,false)}}.bind(this),E=c("TimeSlice").getGuardedContinuation("PhotoSnowlift image load");D=E.bind(null,D);if(c("EncryptedImg").isEncrypted(y))c("EncryptedImg").load(y,D);else{var F=new Image(),G=c("Event").listen(F,"load",D),H=function H(){if(G){c("TimeSlice").cancel(E);G.remove();G=null}};c("Arbiter").subscribeOnce("PhotoSnowlift.SWITCH_IMAGE",H);c("Arbiter").subscribeOnce("PhotoSnowlift.CLOSE",H);F.src=y}this._log(y)}.bind(this),0);c("CSS").hide(this.stageActions);this.setStagePagersState("disabled")};x.prototype.initialDataFetched=function(y){__p&&__p();c("PhotoSessionLog").setPhotoSet(this.stream.getPhotoSet());c("PhotoSessionLog").setLogFbids(y.logids);if(y.eid)c("PhotoSessionLog").setEid(y.eid);this._albumBoundaries.start=this.stream.getCursor();var z=this.stream.getCurrentImageData();if(z){var A=this.getImageURL(z),B=!c("PhotoSnowliftLoggingConfig").checkForImage||A;if(B){c("PhotoSessionLog").addPhotoView(z.info,this.shouldShowHiRes(z),this.fullscreen&&c("FullScreen").isFullScreen());if(c("PhotoSnowliftLoggingConfig").logOnlyOnInit)c("PhotoSessionLog").logInitialLoad()}}var C=this.stream.getCurrentExtraData();if(this._showHover&&C)c("PhotoTagSearchPivotLogger").logImageImpression("snowlift",String(this.stream.getCursor()),Object.keys(C.tagRects));if(C&&C.source!==undefined){this.source=parseInt(C.source,10);c("PhotoSessionLog").setSource(this.source)}if(!this.pageHandlers)this.pageHandlers=[c("Event").listen(this.root,"click",this.pageListener.bind(this)),c("Event").listen(this.root,"mouseleave",this.mouseLeaveListener.bind(this))];this.showZoom(z);c("CSS").show(this.stageActions);this.root.setAttribute("aria-busy","false");if(z.info.ocmarkup)this.showObjectionableWarning(z.info.ocmarkup);else this.hideObjectionableWarning();if(z.info.disablecontextmenu)this.disableContextMenu();else this.enableContextMenu()};x.prototype.adjustScrollerIfNecessary=function(){clearTimeout(this.scrollerTimeout);this.scrollerTimeout=setTimeout(this.adjustScroller.bind(this),0)};x.prototype.adjustScroller=function(y){__p&&__p();clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var z=c("Vector").getElementDimensions(this.rhc),A=z.y;A-=c("Vector").getElementDimensions(this.rhcHeader).y;A-=c("Vector").getElementDimensions(this.ufiInputContainer).y;if(this.seeMore)A-=c("Vector").getElementDimensions(this.seeMore).y;if(this.placeInfo){var B=c("Vector").getElementDimensions(this.placeInfo);A-=B.y;c("Style").set(this.sideAdUnit,"bottom",B.y+"px")}if(y==null)y=this.resizeCommentsForAds?this.lastAdsHeight:0;this.lastAdsHeight=y;A=Math.max(0,A);var C=c("Vector").getElementDimensions(this.scrollerBody).y,D=Math.max(x.MIN_UFI_HEIGHT,A-y);if(C>=D){if(A>D){c("CSS").removeClass(this.rhc,"pinnedUfi");A-=D}else{c("CSS").addClass(this.rhc,"pinnedUfi");A=0}c("Style").set(this.scroller,"height",D+"px")}else{c("Style").set(this.scroller,"height","auto");c("CSS").removeClass(this.rhc,"pinnedUfi");A-=C}var E=c("Vector").getElementDimensions(this.ufiInputContainer).y;c("Style").set(this.ufiForm,"padding-bottom",E+"px");c("PhotoSnowliftAds").resize(new(c("Vector"))(z.x,A));this.scrollableArea.adjustGripper()};x.prototype.adjustForResize=function(){this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData()};x.prototype.shouldShowHiRes=function(y){if(!y||!y.smallurl)return false;var z=this.getStageSize(y.dimensions);z=this._adjustStageSizeForPixelRatio(z);var A=this.getImageSizeInStage(y.dimensions,z);return A.x>x.STAGE_NORMAL_MAX.x||A.y>x.STAGE_NORMAL_MAX.y};x.prototype._adjustStageSizeForPixelRatio=function(y){if(window.devicePixelRatio&&window.devicePixelRatio>1)y=new(c("Vector"))(y.x*window.devicePixelRatio,y.y*window.devicePixelRatio);return y};x.prototype.getImageURL=function(y){if(y.video)return null;else if(y.smallurl&&!this.shouldShowHiRes(y))return y.smallurl;return y.url};x.prototype.getImageOrVideoDimensions=function(y){if(y.video){var z=this.getVideoElement(y.video);if(z)return this.getVideoSize(z)}return this._viewable.getNaturalDimensions()};x.prototype.getStageSize=function(y,z){__p&&__p();var A=c("Vector").getViewportDimensions();if(this._isLiveBroadcast)A.y-=200;var B=new(c("Vector"))(y.x,y.y);if(z)B=new(c("Vector"))(Math.max(y.x,z.x),Math.max(y.y,z.y));var C,D;if(this.fullscreen&&c("FullScreen").isFullScreen()){D=screen.height-x.FULL_SCREEN_PADDING*2;return new(c("Vector"))(this.rhcCollapsed?screen.width:screen.width-x.SIDEBAR_SIZE_MAX,D)}else{C=Math.min(B.x,A.x-x.SIDEBAR_SIZE_MAX-x.STAGE_CHROME.x);var E=A.y-x.STAGE_CHROME.y;D=Math.min(B.y,E)}if(C===0&&D===0)return new(c("Vector"))(0,0);var F=C/D,G=B.x/B.y;if(F<G)return new(c("Vector"))(C,Math.round(C/G));return new(c("Vector"))(Math.round(D*G),D)};x.prototype.getExtraVerticalSpace=function(){if(this.getVideoOnStage())return x.VIDEO_BOTTOM_BAR_SPACE*2;return 0};x.prototype.getComponentsHeight=function(){var y=this.getVideoOnStage();if(y){var z=c("ge")(y);if(z)return this.getVideoComponentsHeight(z)}return 0};x.prototype.getMinimumStageWidth=function(){var y=x.STAGE_MIN.x;if(this.getVideoOnStage())return y;if(c("PhotoSnowliftActionsGating").ALLOW_MAKE_PROFILE_PICTURE_BUTTON)y+=x.PROFILE_PICTURE_BUTTON_WIDTH;return y};x.prototype.getImageSizeInStage=function(y,z){__p&&__p();var A=y.x,B=y.y,C=this.getComponentsHeight(),D=this.getExtraVerticalSpace();B-=C;z=new(c("Vector"))(z.x,z.y-C-D);if(A>=z.x||B>=z.y){var E=z.x/z.y,F=A/B;if(E<F){A=z.x;B=Math.round(A/F)}else if(E>F){B=z.y;A=Math.round(B*F)}else{A=z.x;B=z.y}}return new(c("Vector"))(A,B+C)};x.prototype.adjustStageSize=function(y){__p&&__p();var z=this.currentImageSize;if(y)z=y;else{var A=this.stream&&this.stream.getCurrentImageData();if(A)z=this.getImageOrVideoDimensions(A)}if(!z)return;this.currentImageSize=z;var B=this.getExtraVerticalSpace();if(this.shouldStretch&&!this.getVideoOnStage()&&z.x>z.y&&z.x<=x.TIMELINE_STRETCH_WIDTH&&z.x>=x.TIMELINE_STRETCH_MIN){z.y=Math.round(z.y*x.TIMELINE_STRETCH_WIDTH/z.x);z.x=x.TIMELINE_STRETCH_WIDTH}var C=this.getStageSize(z,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new(c("Vector"))(0,0);this.currentMinSize=new(c("Vector"))(Math.max(C.x,this.getMinimumStageWidth(),this.currentMinSize.x),Math.max(C.y,x.STAGE_MIN.y,this.currentMinSize.y));var D=this.getImageSizeInStage(z,this.currentMinSize),E=this.currentMinSize.x-D.x,F=this.currentMinSize.y-D.y;if(E>0&&E<x.PADDING_MIN)this.currentMinSize.x-=E;else if(F>0&&F<x.PADDING_MIN)this.currentMinSize.y-=F;var G=this.currentMinSize.x+x.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)G=this.currentMinSize.x;var H=this.getVideoOnStage()&&this.pivotsCarouselElement,I=0,J=this.currentMinSize.y;if(H){var K=this.pivotsCarouselElement.clientHeight;I=Math.ceil(K/100)*100;J+=I}this.snowliftPopup.style.cssText="width:"+G+"px;height:"+J+"px;";var L=this.currentMinSize.y-B,M=L+I;if(c("UserAgent_DEPRECATED").firefox()){var N=c("Style").get(this.stageWrapper,"font-size");L=L/parseFloat(N)+"em";M=M/parseFloat(N)+"em"}else{L+="px";M+="px"}this.stageWrapper.style.cssText="width:"+this.currentMinSize.x+"px;line-height:"+L+";";if(this.getVideoOnStage()){this.videoStage.style.cssText="width:"+this.currentMinSize.x+"px;height:"+M+";";if(!this._inputBarAdjusted&&this._isLiveBroadcast){var O=parseInt(c("Style").get(this._liveInputBar,"right"),10);c("Style").set(this._liveInputBar,"right",O+E/2+"px");this._inputBarAdjusted=true}}D.y-=this.getComponentsHeight();this.setMediaElementSize(D);if(H)this.setPivotCarouselElementWidth(N);var P=this.getTagger();if(P)P.repositionTagger();this.adjustScrollerIfNecessary()};x.prototype.setMediaElementSize=function(y){__p&&__p();var z=this.image;if(this.getVideoOnStage())if(this._videoPlayerStateManager&&this._videoPlayerStateManager.setDimensions){this._videoPlayerStateManager.setDimensions(y.x,y.y);return}else z=c("DOM").scry(this.videoStage,"._53j5")[0]||z;else{this._viewable.setDimensions(y);return}if(!z)return;z.style.cssText="width:"+y.x+"px;height:"+y.y+"px;"};x.prototype.setPivotCarouselElementWidth=function(y){var z=this.videoStage.clientWidth;if(c("UserAgent_DEPRECATED").firefox())z=z/parseFloat(y)+"em";else z+="px";this.pivotsCarouselElement.style.width=z};x.prototype.adjustForNewData=function(){var y=this._viewable.getDimensions(),z=c("DOM").scry(this.stage,"div.tagsWrapper")[0];if(z){c("Style").set(z,"width",y.x+"px");c("Style").set(z,"height",y.y+"px")}};x.prototype.adsDisplayedCallback=function(y,z){var A=this.resizeCommentsForAds&&!this.inAdsDisplayedCallback&&!this.disableAds&&y<x.MIN_ADS_VISIBLE&&z.length>=x.MIN_ADS_VISIBLE;if(A){this.inAdsDisplayedCallback=true;var B=z[x.MIN_ADS_VISIBLE-1];this.adjustScroller(B);this.inAdsDisplayedCallback=false}};x.prototype.setLoadingState=function(y,z){__p&&__p();switch(y){case x.STATE_IMAGE_PIXELS:c("CSS").conditionClass(this.root,"imagePixelsLoading",z);break;case x.STATE_IMAGE_DATA:this.loadingStates[y]=z;c("CSS").conditionClass(this.root,"imageLoading",z);break;case x.STATE_HTML:this.loadingStates[y]=z;c("CSS").conditionClass(this.root,"dataLoading",z);this.rhc.setAttribute("aria-busy",z?"true":"false");break}};x.prototype.destroy=function(){__p&&__p();this.stageHandlers.forEach(function(y){y.remove()});if(this.pageHandlers){this.pageHandlers.forEach(function(y){y.remove()});this.pageHandlers=null}if(this._actionsMenuSubscriptionsHandler){this._actionsMenuSubscriptionsHandler.release();this._actionsMenuSubscriptionsHandler=null}this._videoPlayerStateManager=null};x.prototype.checkState=function(y){__p&&__p();var z=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(y!=x.STATE_ERROR&&!this.loadingStates[y])return;switch(y){case x.STATE_IMAGE_DATA:var A=this.stream.getCurrentImageData();if(A){var B=this.getImageURL(A);if(B)this._switchViewable(B,null,true,z);else if(A.video)if(A.shouldDelayStartupVideo)c("setImmediate")(function(){return this.switchVideo(A.video,true)}.bind(this));else this.switchVideo(A.video,true);this.setLoadingState(y,false)}break;case x.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(y,false)}break;default:if(this.stream.errorInCurrent()){this._viewable.hide();c("CSS").show(this.errorBox)}break}};x.prototype.buttonListener=function(event){__p&&__p();var y=event.getTarget(),z=Date.now();if(c("Parent").byClass(y,"fbPhotoTagApprovalBox")){c("FunnelLogger").appendAction(o,"approve_photo_tag");return}if(z-this.lastPage<350)return;if(c("Parent").byClass(y,"fbPhotosPhotoLike"))this.likePhoto();else if(c("Parent").byClass(y,"tagApproveIgnore")){this.updateTagBox(event,y);c("FunnelLogger").appendAction(o,"ignore_photo_tag")}else if(c("Parent").bySelector(y,"._5ymu")){if(!this._showingMorePhotos){c("PhotoTagSearchPivotLogger").logShowMorePhotos();var A=this.stream.getCursor();if(A)this.showMorePhotos(String(A))}else{c("PhotoTagSearchPivotLogger").logHideMorePhotos();this.hideMorePhotos()}return}this.hideMorePhotos()};x.prototype.likePhoto=function(){__p&&__p();c("FunnelLogger").appendActionWithTag(o,"like_photo","snowlift-feedback");c("PhotoSessionLog").addButtonLike();var y=c("$")("fbPhotoSnowliftFeedback"),z=c("DOM").scry(y,"button.like_link")[0];if(!z)z=c("DOM").scry(y,"a.UFILikeLink")[0];var A=z.getAttribute("href");if(c("FullScreen").isFullScreen())if(c("UserAgent_DEPRECATED").chrome())z.setAttribute("href","javascript:;");z.click();z.setAttribute("href",A)};x.prototype.toggleLikeButton=function(){__p&&__p();var y=c("DOM").scry(this.buttonActions,"a.fbPhotosPhotoLike")[0];if(y){var z=c("DOM").find(this.root,".likeCount"),A=c("DOM").find(z,".likeCountNum"),B=c("CSS").hasClass(y,"viewerLikesThis");c("FunnelLogger").appendActionWithTag(o,B?"unlike_photo":"like_photo","snowlift-feedback");if(z)if(B)c("DOM").setContent(A,parseInt(A.textContent,10)-1);else c("DOM").setContent(A,parseInt(A.textContent,10)+1);c("CSS").toggleClass(y,"viewerLikesThis");c("CSS").removeClass(y,"viewerAlreadyLikedThis")}};x.prototype.likePhotoWithKey=function(){return c("LikeConfirmer").like(this.likePhoto.bind(this),c("getActiveElement")())};x.prototype.updateTagBox=function(y,z){__p&&__p();this.unhiliteAllTags();var A=c("ge")(y);if(!A)return;c("CSS").addClass(A,"tagBox");c("CSS").addClass(A,"tagBoxPendingResponse");c("CSS").removeClass(A,"tagBoxPending");c("CSS").hide(c("DOM").find(A,"span.tagForm"));if(z)c("CSS").show(c("DOM").find(A,"span.tagApproved"));else c("CSS").show(c("DOM").find(A,"span.tagIgnored"))};x.prototype.rotate=function(y){__p&&__p();var z=this.stream.getCursor();if(this.getVideoOnStage()){var A=y=="left"?270:90;!!this.videoRotateURI||k(0);c("Bootloader").loadModules(["VideoRotate"],function(C){new C(z,this.videoRotateURI).motionRotate(A)}.bind(this),"PhotoSnowlift");return}var B=babelHelpers["extends"]({fbid:z,opaquecursor:this.stream.getOpaqueCursor(z),cs_ver:c("PhotosConst").VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());B[y]=1;this.setLoadingState(x.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);this._viewable.hide();new(c("AsyncRequest"))("/ajax/photos/photo/rotate/").setAllowCrossPageTransition(true).setData(B).setErrorHandler(this.rotationError.bind(this,z)).setFinallyHandler(this.rotationComplete.bind(this,z)).setMethod("POST").setReadOnly(false).send()};x.prototype.rotationComplete=function(y,z){if(y==this.stream.getCursor()){this.setLoadingState(x.STATE_IMAGE_DATA,false);this._switchViewable(this.getImageURL(this.stream.getCurrentImageData()));this.swapData()}};x.prototype.rotationError=function(y,z){if(y==this.stream.getCursor()){this.setLoadingState(x.STATE_IMAGE_DATA,false);this._switchViewable(this.getImageURL(this.stream.getCurrentImageData()));c("Bootloader").loadModules(["AsyncResponse"],function(A){A.defaultErrorHandler(z)},"PhotoSnowlift")}};x.prototype.saveTagsFromPayload=function(y){this.storeFromData(y);if("data"in y&&this.stream.getCursor()in y.data)this.swapData()};x.prototype.saveEdit=function(){if(!c("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode"))return;c("Bootloader").loadModules(["PhotoInlineEditor","FormSubmit"],function(y,z){var A=y.getInstance(this.getViewerConst());A&&z.send(A.getForm().controller)}.bind(this),"PhotoSnowlift")};x.prototype.mouseLeaveListener=function(event){this.unhiliteAllTags();this.reHilitePendingTag()};x.prototype.hilitePager=function(event){__p&&__p();var y=c("Vector").getEventPosition(event),z=c("Vector").getElementPosition(this.stage),A=c("Vector").getElementDimensions(this.stage);if(c("Locale").isRTL())this.stagePagerPrev=A.x-(y.x-z.x)<x.GOPREV_AREA;else this.stagePagerPrev=y.x-z.x<x.GOPREV_AREA;c("CSS").conditionClass(this.prevPager,"hilightPager",this.stagePagerPrev);c("CSS").conditionClass(this.nextPager,"hilightPager",!this.stagePagerPrev);var B,C=event.getTarget();if(!c("Parent").byClass(C,"snowliftOverlay")&&!c("Parent").byClass(C,"bottomBarActions")&&!c("Parent").byClass(C,"snowliftPager"))B=x.PAGER_FADE;this.showPagers(B)};x.prototype.showPagers=function(y){clearTimeout(this.fadePagerTimer);this.setStagePagersState("active");if(y!==undefined)this.fadePagerTimer=setTimeout(this.hidePagers.bind(this),y)};x.prototype.hidePagers=function(){if(this._mouseOnPhotoStage||this._actionMenuOpen)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState("inactive")};x.prototype.getTagger=function(){return this.PhotoTagger&&this.PhotoTagger.getInstance(c("PhotosConst").VIEWER_SNOWLIFT)};x.prototype.unhiliteAllTags=function(){__p&&__p();clearTimeout(this.unhiliteTimer);c("DOM").scry(this.stage,"div.tagsWrapper div.hover").forEach(function(z){c("CSS").removeClass(z,"hover")});c("DOM").scry(this.stage,"div.tagsWrapper div.otherActive").forEach(function(z){c("CSS").removeClass(z,"otherActive")});this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!c("CSS").hasClass(this.root,"taggingMode")){var y=this.getTagger();if(y&&!y.isSpherical){y.hideTagger();y.setCurrentFacebox(null)}}};x.prototype.switchHilitedTags=function(y,z){__p&&__p();if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null}this.unhiliteAllTags();this.hiliteAllBoxes();var A=c("ge")(y);if(A){this.hilitedTag=y;if(!c("CSS").hasClass(this.root,"taggingMode")&&c("PhotosUtils").isFacebox(this.hilitedTag)){var B=this.getTagger();if(B){c("CSS").addClass(A,"hover");var C=B.getFacebox(y);B.setCurrentFacebox(C);if(C)B.addTagFromFacebox(C)}}else c("CSS").addClass(A,"hover");if(c("CSS").hasClass(A,"tagBoxPending")&&!c("CSS").hasClass(A,"showPendingTagName")&&z===true){c("DOM").scry(this.stage,"div.tagsWrapper div.showPendingTagName").forEach(function(D){c("CSS").removeClass(D,"showPendingTagName")});c("CSS").addClass(A,"showPendingTagName")}}};x.prototype.reHilitePendingTag=function(){var y=c("ge")(this.hilitedTag);if(y&&c("CSS").hasClass(y,"showPendingTagName"))return;var z=c("DOM").scry(this.stage,"div.tagsWrapper div.showPendingTagName")[0];if(z)this.switchHilitedTags(z.id)};x.prototype.hiliteTagsOnMouseMove=function(event){__p&&__p();if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var y=event.getTarget();if(c("Parent").byClass(y,"snowliftOverlay")||c("Parent").byClass(y,"fbPhotoSnowliftTagApproval")||c("Parent").byClass(y,"tagPointer")||c("Parent").byClass(y,"arrow")||c("Parent").byClass(y,"faceboxSuggestion")||c("Parent").byClass(y,"typeaheadWrapper")||c("Parent").byClass(y,"photoTagTypeahead")||c("Parent").byClass(y,"ufiContainer"))return;var z=c("Parent").byClass(y,"tagBoxPending"),A=false;if(this.hilitedTag){var B=c("ge")(this.hilitedTag);A=B&&c("CSS").hasClass(B,"tagBoxPending")}var C=!this.hilitedTag&&z||!A&&z;if(C){this.switchHilitedTags(z.id);return}if(z&&z.id==this.hilitedTag)return;var D=250,E=15,F=c("Vector").getEventPosition(event);if(!this.startingMousePos)this.startingMousePos=F;var G=c("PhotosUtils").absoluteToNormalizedPosition(this._viewable.getElement(),F);if(!this.haveLeftBufferRegion&&this.startingMousePos.distanceTo(F)<E)return;else this.haveLeftBufferRegion=true;if(this.currentTagHasPrecedence(G))return;var H=c("PhotosUtils").getNearestBox(this.stream.getCurrentExtraData().tagRects,G);if(!H){if(!A){this.unhiliteAllTags();this.reHilitePendingTag()}return}var I=null;if(A){var J={};J[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];I=c("PhotosUtils").getNearestBox(J,G)}if(I!==null&&A)return;if(this.hilitedTag!=H)if(A)this.switchTimer=setTimeout(this.switchHilitedTags.bind(this,H),D);else{if(this._showHover&&!this._seenTags[H]){this._seenTags[H]=true;c("PhotoTagSearchPivotLogger").logPivotImpression("snowlift",H)}this.switchHilitedTags(H)}};x.prototype.currentTagHasPrecedence=function(y){if(!this.hilitedTag)return false;if(this.stream.getCurrentExtraData().tagRects[this.hilitedTag]===undefined){this.hilitedTag=null;return false}var z=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],A=new(c("Rect"))(z.t+z.h()/2,z.r,z.b+(c("PhotosUtils").isFacebox(this.hilitedTag)?10:0),z.l,z.domain);return A.contains(y)};x.prototype.getVideoOnStage=function(){var y=this.stream&&this.stream.getCurrentImageData();return y&&y.video};x.prototype.shouldPageOnAction=function(y,z){__p&&__p();if(!this.isOpen||c("LikeConfirmer").isShowingConfirmation())return false;var A=c("isNode")(z)&&(c("Parent").byClass(z,"snowliftPager")||c("Parent").byClass(z,"stagePagers")||c("Parent").byClass(z,"pivotPageColumn")),B=c("isNode")(z)&&c("Parent").byClass(z,"stage"),C=c("CSS").hasClass(z,"faceBox"),D=!c("CSS").hasClass(this.root,"taggingMode")&&C&&!A;if(D){if(!this.showingTypeaheadSuggestions){this.getTagger().updateWithSuggestions();setTimeout(function(){c("DOM").find(this.getTagger().tagger,"input.textInput").focus()}.bind(this),0)}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;return false}var E=B&&c("CSS").hasClass(this.root,"taggingMode")||c("Parent").byClass(z,"tagBoxPending")||c("Parent").byClass(z,"tagBoxPendingResponse")||c("Parent").byClass(z,"fbPhotoTagApprovalBox")||c("Parent").byClass(z,"tag")||c("Parent").byClass(z,"sphericalHeadingIndicator");if(E)return false;return y==c("Keys").LEFT||y==c("Keys").RIGHT||y==p||y==q||A||D||B};x.prototype.keyHandler=function(y,event){__p&&__p();if(event.getModifiers().any||c("Layer").getTopmostLayer()!==this.spotlight)return true;switch(c("Event").getKeyCode(event)){case c("Keys").LEFT:case c("Keys").RIGHT:case p:case q:this.pageListener(event);return false;case r:c("FunnelLogger").appendActionWithTagIfNew(o,c("FullScreen").isFullScreen()?"fullscreen_exit":"fullscreen_enter","key-f");return this.toggleFullScreen();case s:return this.likePhotoWithKey();case c("Keys").SPACE:this.showPagers(x.PAGER_FADE);return false}return null};x.prototype.shouldHandlePendingTag=function(event){var y=this.getTagger();if(!y||!y.tags.length)return false;var z=c("PhotosUtils").absoluteToNormalizedPosition(this.getImage(),c("Vector").getEventPosition(event)),A=y.findNearestTag(z);if(!A||!c("CSS").hasClass(A.node,"tagBoxPending"))return false;c("Arbiter").inform("PhotoTagApproval.PENDING_TAG_PHOTO_CLICK",{id:A.id,version:this.getVersionConst()});return true};x.prototype.pageListener=function(event){__p&&__p();var y=c("Event").getKeyCode(event),z=event.getTarget();if(!this.shouldPageOnAction(y,z))return;if(this.shouldHandlePendingTag(event))return;var A=0,B=null;if(y==c("Keys").RIGHT||y==q){A=1;c("FunnelLogger").appendActionWithTag(o,"image_prev","key-right");c("PhotoSessionLog").setPagingAction("key_right");this._disableMouseOver=true}else if(y==c("Keys").LEFT||y==p){A=-1;c("FunnelLogger").appendActionWithTag(o,"image_next","key-left");c("PhotoSessionLog").setPagingAction("key_left");this._disableMouseOver=true}else if(c("Parent").byClass(z,"next")){A=1;c("FunnelLogger").appendActionWithTag(o,"image_next","button-next");c("PhotoSessionLog").setPagingAction("click_next")}else if(c("Parent").byClass(z,"prev")){A=-1;c("FunnelLogger").appendActionWithTag(o,"image_prev","button-prev");c("PhotoSessionLog").setPagingAction("click_prev")}else if(B=c("Parent").byClass(z,"seek")){var C=c("DataStore").get(B,"seek-fbid");A=this.stream.getRelativeMovement(C);c("PhotoSessionLog").setPagingAction("seek")}else if(!this.stagePagerPrev){A=1;c("FunnelLogger").appendAction(o,"image_next","click-stage");c("PhotoSessionLog").setPagingAction("click_stage")}else{A=-1;c("FunnelLogger").appendAction(o,"image_prev","click-stage");c("PhotoSessionLog").setPagingAction("click_stage_back")}var D=c("DOM").scry(this.ufiForm,"input.mentionsHidden"),E=false;for(var F=0;F<D.length;F++)if(!c("Input").isEmpty(D[F])){E=true;break}if(E||c("CSS").hasClass(this.root,"fbPhotoSnowliftEditMode"))this.warnLeavePage(this.page.bind(this,A));else this.page(A,c("UserAgent_DEPRECATED").chrome()&&c("FullScreen").isFullScreen())};x.prototype.warnLeavePage=function(y){new(c("Dialog"))().setTitle(j._("\uc774 \ud398\uc774\uc9c0\uc5d0\uc11c \ub098\uac00\uc2dc\uaca0\uc5b4\uc694?")).setBody(j._("\uc544\uc9c1 \uc800\uc7a5\ud558\uc9c0 \uc54a\uc740 \ubcc0\uacbd \ub0b4\uc6a9\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ud398\uc774\uc9c0\uc5d0\uc11c \ub098\uac00\uc2e4 \uacbd\uc6b0 \ubcc0\uacbd \ub0b4\uc6a9\uc774 \uc800\uc7a5\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.")).setButtons([{name:"leave_page",label:j._("\ud398\uc774\uc9c0\uc5d0\uc11c \ub098\uac00\uae30"),handler:y},{name:"continue_editing",label:j._("\uc774 \ud398\uc774\uc9c0\uc5d0 \uba38\ubb3c\uae30"),className:"inputaux"}]).setModal(true).show()};x.prototype.getUsesOpaqueCursor=function(){return this.stream.getUsesOpaqueCursor()};x.prototype.getOpaqueCursor=function(y){return this.stream.getOpaqueCursor(y)};x.prototype.setReachedLeftEnd=function(){this.stream.setReachedLeftEnd()};x.prototype.setReachedRightEnd=function(){this.stream.setReachedRightEnd()};x.prototype._initLitestandShareAttachments=function(){var y=c("DOMQuery").scry(this.root,"."+c("LitestandShareAttachment").getSimpleCropClass());y.forEach(function(z){return c("LitestandShareAttachment").init(z)})};x.prototype.page=function(y,z,A){__p&&__p();if(!this.stream.isValidMovement(y)||!this.stream.nonCircularPhotoSetCanPage(y)){this.showPagers(x.PAGER_FADE);return}var B=this.stream.getCursorAt(this.stream.calculatePositionForMovement(y));if(this.snowflake&&(this.stream.getCursor()==this.firstInSet&&y<0||this.firstInSet==B&&y>0)){this.showPagers(x.PAGER_FADE);return}this.lastPage=Date.now();this.unhiliteAllTags();this.startingMousePos=null;this.haveLeftBufferRegion=false;this._seenTags={};this._navCount+=y;var C=this.stream.allLoaded?Math.abs(this._navCount)-this.stream.getLength():null;if(this._extraSlidePivot&&this._albumFBID){if(!this._albumBoundaries.end&&C===0){this._albumBoundaries.end=this.stream.getCursor();this._albumBoundaries.dir=y}else if(C===-1)c("PhotosetSearchPivotData").fetch(this._albumFBID,this.stream);if(!this.onExtraSlide){if(this.stream.getCursor()===this._albumBoundaries.end&&B===this._albumBoundaries.start&&y===this._albumBoundaries.dir){this.showPivotSlide(this._albumFBID,z);return}else if(this.stream.getCursor()===this._albumBoundaries.start&&B===this._albumBoundaries.end&&y===-this._albumBoundaries.dir)this.showPivotSlide(this._albumFBID,z)}else{this.hidePivotSlide();if(y===-this._albumBoundaries.dir)return}}var D=this.getVideoOnStage();if(D)this.switchVideo(D,false);if(this.pivots&&this.pivots.page(y))return;c("Arbiter").inform("PhotoSnowlift.PAGE");c("Toggler").hide();this.recacheData();this.stream.moveCursor(y);this._viewable.hide();if(y!==0){this.storyID=null;this._updateContainerOwnerID()}if(this.stream.errorInCurrent()){this.setLoadingState(x.STATE_HTML,true);c("CSS").show(this.errorBox);return}this.movementDelta+=y;var E=this.stream.getCurrentImageData();if(E){var F=this.getImageURL(E);if(F)this._switchViewable(F,null,true);else if(E.video)this.switchVideo(E.video,true,A);if(E.info.ocmarkup)this.showObjectionableWarning(E.info.ocmarkup);else this.hideObjectionableWarning();if(E.info.disablecontextmenu)this.disableContextMenu();else this.enableContextMenu();if(!z){this.replaceUrl=true;c("goURI")(E.info.permalink)}this.setLoadingState(x.STATE_IMAGE_DATA,false)}else{this.setLoadingState(x.STATE_IMAGE_PIXELS,true);this.setLoadingState(x.STATE_IMAGE_DATA,true)}if(this.stream.getCurrentHtml())this.swapData();else this.setLoadingState(x.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer||this.stream.isInViewAsMode();this.loadAds();this.setLeftAndRightPagersState();if(!this._extraSlidePivot&&this._showMorePhotos&&this._albumFBID)if(C===-1)c("PhotosetSearchPivotData").fetch(this._albumFBID,this.stream);else if(C===0){c("PhotoTagSearchPivotLogger").logSuggestMorePhotos();this.showMorePhotos(this._albumFBID,true);this.showPagers();this._navCount=0}else{this.hideMorePhotos();this.hidePagers()}this._initLitestandShareAttachments()};x.prototype.showMorePhotos=function(y,z){if(this._showingMorePhotos)return;this._showingMorePhotos=true;if(!this.searchPivot)this.searchPivot=this.overlay.appendChild(document.createElement("div"));c("CSS").addClass(this.stageWrapper,"_5ymv");this.searchPivotComponent=new(c("ReactComponentRenderer"))(c("PhotosetSearchPivot.react"),this.searchPivot);this.searchPivotComponent.setProps({className:"_27g",fbid:y,onclose:this.hideMorePhotos.bind(this),endofalbum:z||false,withBackground:true})};x.prototype.hideMorePhotos=function(){if(this.searchPivotComponent&&this._showingMorePhotos){this._showingMorePhotos=false;c("CSS").removeClass(this.stageWrapper,"_5ymv");this.searchPivotComponent.setProps({fbid:null})}};x.prototype.showPivotSlide=function(y,z){__p&&__p();if(this.onExtraSlide)return;this.onExtraSlide=true;c("CSS").addClass(this.stageWrapper,"_3tvf");if(!this.pivotSlide){this.pivotSlide=c("DOM").create("div");c("DOM").insertBefore(this.stageActions,this.pivotSlide)}this.pivotSlideComponent=new(c("ReactComponentRenderer"))(c("PhotosetPivotSlide.react"),this.pivotSlide);this.pivotSlideComponent.setProps({fbid:y,isAlbum:this._isAlbum,albumOwnerName:this._albumOwnerName,visible:true,onReturn:this.page.bind(this,this._albumBoundaries.dir,z)})};x.prototype.hidePivotSlide=function(){if(this.pivotSlideComponent&&this.onExtraSlide){this.pivotSlideComponent.setProps({visible:false});c("CSS").removeClass(this.stageWrapper,"_3tvf")}this.onExtraSlide=false};x.prototype.logImpressionDetailsForPhoto=function(){__p&&__p();var y=[].concat(c("DOM").scry(c("$")("fbPhotoSnowliftTagList"),"input.photoImpressionDetails"),c("DOM").scry(c("$")("fbPhotoSnowliftFeedback"),"input.photoImpressionDetails"));if(y.length===0)return;var z={};for(var A=0;A<y.length;A++)z[y[A].name]=y[A].value;if(this.getVideoOnStage()){z.width=0;z.height=0}else{var B=this._viewable.getNaturalDimensions();z.width=B.x;z.height=B.y}c("PhotoSessionLog").addDetailData(this.stream.getCursor(),z);c("PhotoSnowliftAds").setIsLogAdData(true)};x.prototype.loadAds=function(){if(this.disableAds)return;c("PhotoSnowliftAds").loadAdsFromUserActivity()};x.prototype.transitionHandler=function(y){__p&&__p();if(y.getQueryData().closeTheater||y.getQueryData().permPage||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(y.getQualifiedURI().toString());c("PageTransitions").transitionComplete(true);return true}var z=this._uriStack.length;if(z>=2&&this._uriStack[z-2]==y.getQualifiedURI().toString())this._uriStack.pop();var A=this.stream.getCursorForURI(y.getUnqualifiedURI().toString());if(A){var B=this.stream.getRelativeMovement(A);this.page(B,true);c("PageTransitions").transitionComplete(false);return true}if(this.isOpen){c("PageTransitions").transitionComplete(true);this.close();return true}this.transitionHandlerRegistered=false;return false};x.prototype.recacheData=function(){if(!this.loadingStates.html){var y=this.stream.getCurrentHtml();for(var z in y){var A=c("$")(z);y[z]=Array.from(A.childNodes);c("DOM").empty(A)}}};x.prototype.reloadIfTimeout=function(){if(!c("ImageUtils").hasLoaded(this.image)){var y=this.makeNewImage(this.image.src,true);c("Event").listen(y,"load",this.useImage.bind(this,y,null,true));this._log(y.src)}};x.prototype._useViewable=function(y,z,A){__p&&__p();var B=arguments.length<=3||arguments[3]===undefined?false:arguments[3];if(A&&this._viewable.isReady())return;var C=function(){__p&&__p();var D=this._viewable;this._viewable=y;c("DOM").replace(D.getElement(),y.getElement());this.setLoadingState(this.STATE_IMAGE_PIXELS,false);this.adjustStageSize(z);setTimeout(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData()}}.bind(this),0);D.suspend()}.bind(this);y.whenReady(C)};x.prototype.useImage=function(y,z,A){__p&&__p();var B=arguments.length<=3||arguments[3]===undefined?false:arguments[3];if(A&&c("ImageUtils").hasLoaded(this.image))return;var C=function(){c("DOM").replace(this.image,y);this.image=y;this.adjustStageSize(z)}.bind(this);if(!B||c("ImageUtils").hasLoaded(y))C();else c("Event").listen(y,"load",C)};x.prototype.makeNewImage=function(y,z){__p&&__p();if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null}else if(!z)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),x.LOADING_TIMEOUT);var A=c("DOM").create("img",{className:"spotlight",alt:""});A.setAttribute("aria-describedby","fbPhotosSnowliftCaption");A.setAttribute("aria-busy","true");var B=function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute("aria-busy","false");this.setLoadingState(this.STATE_IMAGE_PIXELS,false);setTimeout(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData()}}.bind(this),0)}.bind(this);c("Event").listen(A,"load",B);this._log(y);if(c("EncryptedImg").isEncrypted(y))c("EncryptedImg").insertIntoDOM(y,A);else A.src=y;return A};x.prototype._switchViewable=function(y,z,A){__p&&__p();var B=arguments.length<=3||arguments[3]===undefined?false:arguments[3];c("CSS").hide(this.errorBox);if(!B)this._viewable.hide();this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var C=this.stream&&this.stream.getCurrentImageData();if(C){c("PhotoSessionLog").addPhotoView(C.info,this.shouldShowHiRes(C),this.fullscreen&&c("FullScreen").isFullScreen());if(this._showHover){var D=this.stream.getCurrentExtraData();if(D)c("PhotoTagSearchPivotLogger").logImageImpression("snowlift",String(this.stream.getCursor()),Object.keys(D.tagRects))}}var E=this._viewable.getElement().children[0],F=E.src===y;if(!F||this.isSpherical()){var G=c("PhotoSnowliftViewableUtils").fromStreamData(C,this);if(this.fullscreen&&c("FullScreen").isFullScreen()){G.onToggleIntoFullScreen();G.onEnterFullScreen()}this._log(y);this._useViewable(G,z,false,B)}else{E.setAttribute("alt",C.info.caption);E.setAttribute("aria-busy","true");this.adjustStageSize(z);this._viewable.show();this._log(y)}if(A)this.stream.preloadImages(this.shouldShowHiRes.bind(this));c("Arbiter").inform("PhotoSnowlift.SWITCH_IMAGE")};x.prototype._preloadNextVideo=function(){var y=this.stream.calculatePositionForMovement(1),z=this.stream.getCursorAt(y),A=this.stream.getImageData(z);if(A&&A.video&&A.controller)A.controller.preload()};x.prototype._emptyVideoStage=function(){c("DOM").empty(this.videoStage)};x.prototype.switchVideo=function(y,z,A){__p&&__p();var B,C=this;this._pauseVideoIfNeeded();var D="swf_"+y;window.videoStage=this.videoStage;this._emptyVideoStage();if(z){var E,F,G,H,I;(function(){__p&&__p();C._preloadNextVideo();c("CSS").addClass(C.stageWrapper,"showVideo");E=C.stream.getCurrentImageData();if(C.shouldRenderVideoPivots){c("CSS").hide(C.nextPager);c("CSS").hide(C.prevPager)}var J=void 0,K=void 0;C._abortVideoWhenSwitch=true;if(E.useReactPlayer){J=c("DOM").create("div");var L=new(c("VideoData"))(E.videoData),M=E,N=M.PhotoSnowliftVideoNode;if(N&&!C.PhotoSnowliftVideoNode)C.PhotoSnowliftVideoNode=N;var O=N.getVideoNode(L.getVideoID());if(O){J=O.getVideoContainer();C._videoPlayerStateManager=O.getVideoPlayerController();O.updateDimension(E.width,E.height);if(E.keepReactVideoNodeLoaded)C._abortVideoWhenSwitch=false}else{var P=E.PhotoSnowliftVideo;c("ReactDOM").render(c("React").createElement(P,{width:E.width,height:E.height,videoData:L,ref:function Q(R){return K=R}}),J);C._videoPlayerStateManager=K.getVpc();N.destroyVideoNode()}}else{J=E.video_element;c("DOM").scry(J,"._ox1")[0].style.cssText="";C._videoPlayerStateManager=E.controller}F=null;if(C.pivotsCarouselElement)F=c("DOMQuery").scry(C.pivotsCarouselElement,"._32_l");if(F)F.forEach(function(Q){var R=Q.getAttribute("data-fbid"),S=this.stream.getCursor(),T=c("DOM").find(Q,"._1pqn");if(R===S)c("CSS").show(T);else c("CSS").hide(T)}.bind(C));c("CSS").addClass(J,"videoStageContainer");c("DOM").appendContent(C.videoStage,J);c("DOM").appendContent(C.videoStage,C.pivotsCarouselElement);C.videoContainer=J;if(window[D]&&!c("ge")(D))window[D].write(y);G="video_warning_"+y;H=c("ge")(y);if(!C.videoWarnings)C.videoWarnings=[];if(H&&C.videoWarnings[G])c("DOM").setContent(H,C.videoWarnings[G]);if(E.abortedLoadingOtherVideos){if(C._preloadTimeout)clearTimeout(C._preloadTimeout);C._preloadTimeout=setTimeout(function(){var Q=this.stream.getPreviousImageData(),R=this.stream.getNextImageData();if(R&&R.controller)R.controller.preload();if(Q&&Q.controller)Q.controller.preload()}.bind(C),v)}if(!E.useReactPlayer)C._videoPlayerStateManager.reset();C._videoPlayerStateManager.collectFeedTrackingData();if(!C._videoPlayerStateManager.hasOption("PhotoSnowlift","isInSnowlift"))C._videoPlayerStateManager.registerOption("PhotoSnowlift","isInSnowlift",function(){return true});C._videoPlayerStateManager.emit("PhotoSnowlift/enterSnowlift");if(C._autoplayVideos){I=A||c("VideoPlayerReason").USER;C._videoPlayerStateManager.play(I)}if(C._autoplayNextVideo)C._videoPlayerStateManager.addListener("finishPlayback",function(){var Q=E.info.fbid.toString();if(this.haltAutoplay&&Q!==this.stream.fbidList[this.stream.fbidList.length-1]){if(this.autoplayOptionScreenConfig){var R=this.autoplayOptionScreenConfig.controller;R.registerCallbacks(J,this.chooseToReplayVideo.bind(this,this._videoPlayerStateManager),this.handleAutoplay.bind(this,E))}}else this.handleAutoplay(E)}.bind(C));setTimeout(C.adjustStageSizeForVideo.bind(C,y),0)})()}else{window[D]&&window[D].addVariable("video_autoplay",0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);c("CSS").removeClass(this.stageWrapper,"showVideo")}};x.prototype.removeAutoplayOptionScreen=function(){if(this.autoplayOptionScreenConfig)this.autoplayOptionScreenConfig.controller.removeSelf()};x.prototype.chooseToReplayVideo=function(y){y.play(c("VideoPlayerReason").USER);this.removeAutoplayOptionScreen();this.haltAutoplay=false};x.prototype.handleAutoplay=function(y){var z=y.info.fbid.toString();if(z===this.stream.getCursor()&&z!==this.stream.fbidList[this.stream.fbidList.length-1]){c("SnowliftVideoPivotsCarouselController").adjustCarouselOnAutoPlay();this.page(1,false,c("VideoPlayerReason").AUTOPLAY)}this.removeAutoplayOptionScreen();this.haltAutoplay=false};x.prototype.checkVideoStatus=function(y){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var z=this.getVideoOnStage();if(!z)return;else{if(z!==y)return;this.adjustStageSizeForVideo(y)}};x.prototype.getVideoSize=function(y){var z=new(c("Vector"))(y.getAttribute("data-video-width"),+y.getAttribute("data-video-height")+this.getVideoComponentsHeight(y));if(this._videoPlayerStateManager&&this._videoPlayerStateManager.isSpherical&&this._videoPlayerStateManager.isSpherical()){var A=c("Vector").getViewportDimensions(),B=A.x,C=A.x/2;return new(c("Vector"))(B,C)}else return z};x.prototype.getVideoElement=function(y){return c("DOM").scry(this.videoStage,"._ox1")[0]};x.prototype.getVideoComponentsHeight=function(y){var z=0,A=c("Parent").bySelector(y,"._1c_u");if(!A)return 0;var B=c("DOM").scry(A,"._2i84");if(B.length){var C=B[0].getBoundingClientRect();z=C.bottom-C.top}return z};x.prototype.adjustStageSizeForVideo=function(y){var z=this.getVideoElement(y);if(!z)this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,y),200);else this.adjustStageSize(this.getVideoSize(z))};x.prototype.handleServerError=function(y,z){c("DOM").setContent(this.errorBox,y);this.storeFromData(z)};x.prototype.fixButtonText=function(y){__p&&__p();if(!this.buttonTruncateGk)return;var z=c("DOM").scry(y,".photosTruncatingUIButton"),A=parseInt(c("Style").get(y,"width"),10);if(A>t){var B={tagPhoto:j._("\uc0ac\uc9c4\uc5d0 \ud0dc\uadf8\ud558\uae30"),doneTagPhoto:j._("\ud0dc\uadf8 \uc644\ub8cc"),productTagPhoto:j._("\uc81c\ud488 \ud0dc\uadf8"),doneProductTagPhoto:j._("\ud0dc\uadf8 \uc644\ub8cc"),addLocation:j._("\uc7a5\uc18c \ucd94\uac00"),editPhoto:j._("\uc218\uc815")};for(var C=0;C<z.length;C++){var D=z[C];c("CSS").addClass(D,"_2n0k");c("Tooltip").set(D,B[D.getAttribute("data-buttonname")],"below","center")}}};x.prototype.swapData=function(){__p&&__p();var y=this.stream.getCurrentHtml();if(y){this.setLoadingState(x.STATE_HTML,false);for(var z in y){var A=c("ge")(z);A&&c("DOM").setContent(A,y[z])}var B=c("ge")("photosTruncatingUIButtonGroup");B&&this.fixButtonText(B);c("Arbiter").inform("PhotoSnowlift.DATA_CHANGE",Object.assign(this.stream.getCurrentImageData().info,{movement:this.movementDelta,isSpherical:this.isSpherical()}),c("Arbiter").BEHAVIOR_STATE);this.movementDelta=0;if(this.stream.getCurrentExtraData())c("Arbiter").inform("PhotoSnowlift.EXTRA_DATA_CHANGE",this.stream.getCurrentExtraData(),c("Arbiter").BEHAVIOR_STATE)}this.adjustScroller();this.scrollableArea.showScrollbar({hideAfterDelay:true});this.adjustForNewData();this.logImpressionDetailsForPhoto()};x.prototype.updateTotalCount=function(y,z,A){__p&&__p();var B=this.stream.getCurrentHtml();if(B){var C=c("$")("fbPhotoSnowliftPositionAndCount");c("DOM").replace(C,A);C=A;c("CSS").show(C);var D="fbPhotoSnowliftPositionAndCount";B[D]=Array.from(C.childNodes)}this.stream.setTotalCount(y);this.stream.setFirstCursorIndex(z)};x.prototype.addPhotoFbids=function(y,z,A,B){__p&&__p();if(B&&this.sessionID&&B!=this.sessionID)return;var C=this.stream.getCursor()===null;if(this.shouldRenderVideoPivots&&!this._videoSameAsSource)this.stream.fbidList=[];this.stream.attachToFbidsList(y,z,A);if(A&&C)this.page(0,true);if(this.pivots&&A)this.pivots.setCycleCount(this.stream.calculateDistance(this.stream.getCursor(),this.stream.firstCursor));if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState("ready");this.setLeftAndRightPagersState();if(this.shouldRenderVideoPivots&&!this._videoSameAsSource){var D=this.stream.getCursor(),E=this.stream.calculateDistance(D,this._mediaFBID);this.stream.moveCursor(E)}};x.prototype.attachTagger=function(y,z,A){c("DOM").appendContent(this.stageActions,y);if(z)z.setTokenarea(this.taglist);if(A)c("DOM").appendContent(c("DOM").find(y,"div.faceBox"),A)};x.prototype.setAuthorName=function(y,z){__p&&__p();var A=c("Parent").bySelector(z,".rhc");if(A){this.previousAuthorName=this.currentAuthorName;this.currentAuthorName=y;if(this._navHistory.length>1&&this.previousAuthorName){var B=this._navHistory[this._navHistory.length-2];this.backButton=c("ReactDOM").render(c("React").createElement(c("PhotoSnowliftBackLink.react"),{href:B,name:this.previousAuthorName,visible:true}),z)}else this.backButton=c("ReactDOM").render(c("React").createElement(c("PhotoSnowliftBackLink.react"),{visible:false}),z)}};x.prototype.storeFromData=function(y){__p&&__p();if(!this.isOpen)return;if(y.pivots)this.pivotsCarouselElement=y.pivots;if(y.autoplay_option_screen_config){this.autoplayOptionScreenConfig=y.autoplay_option_screen_config;if(this.autoplayOptionScreenConfig&&this.autoplayOptionScreenConfig.enabled)this.addHaltAutoplaySubscription()}this.shouldRenderVideoPivots=y.should_render_pivots;if(y.ssid&&this.sessionID&&this.sessionID!=y.ssid)return;var z=this.stream.storeToCache(y);if("error"in z){this.checkState(x.STATE_ERROR);return}if("init"in y){if(this.shouldRenderVideoPivots)this._videoSameAsSource=y.init.videoSameAsSource;this._mediaFBID=y.init.fbid;this._albumFBID=y.init.album_fbid;this._isAlbum=y.init.is_album;this._albumOwnerName=y.init.album_owner_name;this._autoplayVideos=y.init.autoplay_videos;this._autoplayNextVideo=y.init.autoplay_next_video;this._referrerProfileID=y.init.referrer_profile_id}else this._preloadNextVideo();var A="init"in z;if(A){this.initialDataFetched(z.init);if(this.openExplicitly){this.replaceUrl=true;c("goURI")(this.stream.getCurrentImageData().info.permalink)}if(this.stream.canPage())this.setStagePagersState("ready");this.setLeftAndRightPagersState()}if("image"in z)this.checkState(x.STATE_IMAGE_DATA,A);if("data"in z)this.checkState(x.STATE_HTML)};x.prototype.setLeftAndRightPagersState=function(){if(this.stream.isNonCircularPhotoSet()){c("CSS").conditionClass(this.root,"disableLeft",!this.stream.nonCircularPhotoSetCanPage(-1));c("CSS").conditionClass(this.root,"disableRight",!this.stream.nonCircularPhotoSetCanPage(1))}if(this.snowflake){c("CSS").conditionClass(this.root,"disableLeft",this.stream.getCursor()==this.firstInSet);var y=this.stream.getCursorAt(this.stream.calculatePositionForMovement(1));c("CSS").conditionClass(this.root,"disableRight",y==this.firstInSet)}};x.prototype.setStagePagersState=function(y){__p&&__p();switch(y){case"ready":c("CSS").addClass(this.root,"pagingReady");this.pagersShown=true;return;case"active":c("CSS").addClass(this.root,"pagingActivated");return;case"inactive":c("CSS").removeClass(this.root,"pagingActivated");return;case"disabled":case"reset":c("CSS").removeClass(this.root,"pagingReady");return}};x.prototype.deletePhoto=function(y){this.closeRefresh()};x.prototype.closeRefresh=function(){this.refreshOnClose=true;this.spotlight.hide()};x.prototype.onHiliteTag=function(y,z){if(z.version!=c("PhotosConst").VIEWER_SNOWLIFT)return;var A=z.tag;if(A)this.switchHilitedTags(A,true)};x.prototype.onUpdateTagBox=function(y,z){if(z.version==c("PhotosConst").VIEWER_SNOWLIFT)this.updateTagBox(z.id,z.approve)};x.prototype.isSpherical=function(){var y=this.stream.getCurrentImageData();return Boolean(y&&y.spherical)||this.thumbSpherical};x.prototype._log=function(y){if(this._shouldLog){this._logger&&this._logger.log(y.startsWith("data:")?c("EncryptedImg").dataUrlPrefix(y):y,String(this.stream.getCursor()),this.getViewerSource(),this._referrerProfileID);return true}return false};x.prototype._enableMouseOver=function(){this._disableMouseOver=false};x.prototype._interceptMouseOver=function(event){if(this._disableMouseOver)event.kill()};x.prototype.isReturningToStart=function(){return!!this.returningToStart};x.prototype._pauseVideoIfNeeded=function(){if(this._videoPlayerStateManager){this._videoPlayerStateManager.pause("unloaded");if(c("VideoPlayerAbortLoadingExperiment").canAbort&&this._abortVideoWhenSwitch)this._videoPlayerStateManager.abortLoading();if(this._videoPlayerStateManager.hasOption("PhotoSnowlift","isInSnowlift"))this._videoPlayerStateManager.unregisterOption("PhotoSnowlift","isInSnowlift");this._videoPlayerStateManager.emit("PhotoSnowlift/exitSnowlift")}};x.prototype._destroyVideoIfNeeded=function(){if(this._videoPlayerStateManager&&c("SnowliftDestroyVideoPlayerExperiment").destroyVideoOnExit)this._videoPlayerStateManager.destroy()};x.prototype.setIsLiveBroadcast=function(){this._isLiveBroadcast=true};x.prototype.registerLiveInputBar=function(y){this._liveInputBar=y};x.prototype.setActionsMenuState=function(y){this._actionMenuOpen=y;if(!y)this.hidePagers()};x.prototype.registerActionsMenu=function(y){this._actionsMenuSubscriptionsHandler=new(c("SubscriptionsHandler"))();this._actionsMenuSubscriptionsHandler.addSubscriptions(y.getPopover().subscribe("show",function(){return this.setActionsMenuState(true)}.bind(this)),y.getPopover().subscribe("hide",function(){return this.setActionsMenuState(false)}.bind(this)))};x.getInstance=function(){if(!x._instance)x._instance=new x();return x._instance};x.initWithSpotlight=function(y,z){x.getInstance().init(y,z)};x.addPhotoFbids=function(y,z,A,B){x.getInstance().addPhotoFbids(y,z,A,B)};x.registerActionsMenu=function(y){var z=x.getInstance();z||k(0);z.registerActionsMenu(y)};x.registerLiveInputBar=function(y){x.getInstance().registerLiveInputBar(y)};x.setIsLiveBroadcast=function(){x.getInstance().setIsLiveBroadcast()};x.setReachedLeftEnd=function(){x.getInstance().setReachedLeftEnd()};x.setReachedRightEnd=function(){x.getInstance().setReachedRightEnd()};x.attachFollowFlyout=function(y){c("DOM").insertAfter(c("$")("fbPhotoSnowliftSubscribe"),y)};x.attachSubscribeFlyout=function(y){c("DOM").insertAfter(c("$")("fbPhotoSnowliftSubscribe"),y)};x.attachTagger=function(y,z,A){x.getInstance().attachTagger(y,z,A)};x.bootstrap=function(y,z){var A=String(c("URI").getMostRecentURI().getQueryData().viewas),B=new(c("URI"))(y).getQueryData();if(!c("PhotoSnowliftLoader").shouldUseSnowlift(B,y,z,A))return;c("FunnelLogger").startFunnel(o);if(z!=null&&c("Parent").bySelector(z,"._18ia")!=null)c("FunnelLogger").addFunnelTag(o,"via_search_media_module");x.getInstance().bootstrap(y,z)};x.closeRefresh=function(){x.getInstance().closeRefresh()};x.deletePhoto=function(y){x.getInstance().deletePhoto(y)};x.getImage=function(){return x.getInstance().getImage()};x.getImageId=function(){return x.getInstance().getImageId()};x.getLoadQuery=function(){return x.getInstance().getLoadQuery()};x.getRHCBody=function(){return x.getInstance().getRHCBody()};x.getRHCFooter=function(){return x.getInstance().getRHCFooter()};x.getRHCHeader=function(){return x.getInstance().getRHCHeader()};x.getRoot=function(){return x.getInstance().getRoot()};x.saveTagsFromPayload=function(y){x.getInstance().saveTagsFromPayload(y)};x.saveTagsFromPayloadDelayed=function(y){setTimeout(x.saveTagsFromPayload.bind(null,y),2e3)};x.handleServerError=function(y,z){x.getInstance().handleServerError(y,z)};x.setAuthorName=function(y,z){x.getInstance().setAuthorName(y,z)};x.storeFromData=function(y){x.getInstance().storeFromData(y)};x.swapData=function(){x.getInstance().swapData()};x.updateTotalCount=function(y,z,A){x.getInstance().updateTotalCount(y,z,A)};x.setVideoRotateURI=function(y){x.getInstance().videoRotateURI=y};Object.assign(x,{STATE_ERROR:"error",STATE_HTML:"html",STATE_IMAGE_PIXELS:"image_pixels",STATE_IMAGE_DATA:"image",LOADING_TIMEOUT:2e3,PAGER_FADE:3e3,FULL_SCREEN_PADDING:10,STAGE_NORMAL_MAX:c("PhotoSnowliftLoader").STAGE_NORMAL_MAX,STAGE_MIN:{x:520,y:520},PROFILE_PICTURE_BUTTON_WIDTH:140,SIDEBAR_SIZE_MAX:c("PhotoSnowliftLoader").SIDEBAR_SIZE_MAX,STAGE_CHROME:c("PhotoSnowliftLoader").STAGE_CHROME,VIDEO_BOTTOM_BAR_SPACE:50,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,PADDING_MIN:40,MIN_UFI_HEIGHT:250,COLLECTIONS_UNTAGGED_PHOTOS:3,PHOTOS_OF_YOU_SUGGESTIONS:28,FRIENDS_IN_PHOTOS_SUGGESTIONS:31,MIN_ADS_VISIBLE:1,PINNED_UFI_ADJUSTMENT:11,ADD_COMMENT_HEIGHT:54,_instance:null,touch:c("emptyFunction"),touchMarkup:c("emptyFunction")});f.exports=x}),null);